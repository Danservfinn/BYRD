<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BYRD Unified AGI Architecture</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
      font-family: 'Inter', system-ui, sans-serif;
    }

    .glass-panel {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
    }

    .sacred-title {
      background: linear-gradient(90deg, #a78bfa, #818cf8, #6366f1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Component styling */
    .component-box {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .component-box:hover .box-bg {
      filter: brightness(1.2);
    }

    .component-box:hover .box-outline {
      stroke-width: 2.5;
      filter: drop-shadow(0 0 8px currentColor);
    }

    .component-box.selected .box-outline {
      stroke-width: 3;
      filter: drop-shadow(0 0 12px currentColor);
    }

    .component-box.deprecated {
      opacity: 0.5;
    }

    .component-box.deprecated .box-outline {
      stroke-dasharray: 4 2;
    }

    /* Flow line animations */
    .flow-line {
      stroke-dasharray: 8 4;
      animation: flowDash 1s linear infinite;
    }

    .flow-line.paused {
      animation-play-state: paused;
    }

    @keyframes flowDash {
      to { stroke-dashoffset: -12; }
    }

    .flow-line.dimmed {
      opacity: 0.15;
    }

    .flow-line.highlighted {
      opacity: 1;
      stroke-width: 3;
    }

    .flow-label {
      font-size: 10px;
      fill: #94a3b8;
      pointer-events: none;
    }

    .flow-label.highlighted {
      fill: #e2e8f0;
      font-weight: 600;
    }

    /* Status indicators */
    .status-dot {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Loop cards */
    .loop-card {
      background: rgba(30, 27, 75, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 8px;
      padding: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .loop-card:hover {
      border-color: rgba(139, 92, 246, 0.5);
      background: rgba(30, 27, 75, 0.8);
    }

    .loop-card.selected {
      border-color: rgba(139, 92, 246, 0.8);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
    }

    /* Mode indicator */
    .mode-indicator {
      transition: all 0.3s ease;
    }

    .mode-indicator.active {
      transform: scale(1.1);
      box-shadow: 0 0 15px currentColor;
    }

    /* Metric bar */
    .metric-bar {
      height: 6px;
      border-radius: 3px;
      background: rgba(100, 116, 139, 0.3);
      overflow: hidden;
    }

    .metric-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 3px;
    }

    /* Legend items */
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #94a3b8;
    }

    .legend-line {
      width: 24px;
      height: 2px;
    }

    /* Coupling indicator */
    .coupling-line {
      stroke-dasharray: 4 2;
      opacity: 0.4;
    }

    .coupling-line.multiplicative {
      stroke-width: 3;
      opacity: 0.8;
      filter: drop-shadow(0 0 4px currentColor);
    }

    .deprecated-badge {
      fill: #ef4444;
      font-size: 6px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="fixed top-0 left-0 right-0 p-4 z-50">
    <div class="glass-panel px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="byrd-3d-visualization.html" class="text-violet-400 hover:text-violet-300 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
        </a>
        <div>
          <h1 class="text-2xl font-bold sacred-title">BYRD Unified AGI Architecture</h1>
          <p class="text-xs text-slate-500 mt-0.5">Core + OpenCode + Goal Cascade + Learning + Rate Limiting + Sovereignty</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <!-- Current Mode -->
        <div id="current-mode" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-violet-500/20 border border-violet-500/30">
          <span class="w-2 h-2 rounded-full bg-violet-400 animate-pulse"></span>
          <span class="text-violet-300 text-sm font-medium">AWAKE</span>
        </div>
        <div id="system-status" class="flex items-center gap-2 text-sm">
          <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
          <span class="text-slate-400">Loading...</span>
        </div>
        <button onclick="toggleAnimation()" id="anim-toggle" class="px-3 py-1.5 bg-violet-500/20 border border-violet-500/50 rounded-lg text-violet-300 hover:bg-violet-500/30 text-sm transition-colors">
          Pause Flow
        </button>
      </div>
    </div>
  </div>

  <!-- Main Flowchart -->
  <div class="fixed top-24 left-4 right-80 bottom-20 flex items-center justify-center overflow-auto">
    <svg id="flowchart" viewBox="0 0 1200 780" class="w-full h-full max-w-7xl">
      <defs>
        <!-- Arrowhead markers -->
        <marker id="arrow-violet" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#a78bfa"/>
        </marker>
        <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
        </marker>
        <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
        </marker>
        <marker id="arrow-amber" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/>
        </marker>
        <marker id="arrow-teal" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#14b8a6"/>
        </marker>
        <marker id="arrow-rose" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#f43f5e"/>
        </marker>
        <marker id="arrow-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#06b6d4"/>
        </marker>
        <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#f97316"/>
        </marker>
        <marker id="arrow-pink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#ec4899"/>
        </marker>

        <!-- Gradients for component boxes -->
        <linearGradient id="grad-memory" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-kernel" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#4c1d95;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e1b4b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-compiler" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#881337;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-reasoner" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#164e63;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-evolver" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#14532d;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-dreaming" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#78350f;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-integration" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#134e4a;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-omega" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#7f1d1d;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-dreamer" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#581c87;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-seeker" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#1d4ed8;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-opencode" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-voice" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#be185d;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-agi" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#854d0e;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-learning" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#4338ca;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-classifier" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#0d9488;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-cascade" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#7c3aed;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-sovereignty" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#db2777;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-rate" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#0369a1;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-deprecated" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#374151;stop-opacity:0.5" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:0.5" />
        </linearGradient>
      </defs>

      <!-- Philosophy Quote -->
      <text x="550" y="25" text-anchor="middle" fill="#64748b" font-size="11" font-style="italic">
        "Desires emerge from reflection, not programming. Human interaction is the wellspring of growth."
      </text>

      <!-- Flow Lines (drawn first, behind components) -->
      <g id="flow-lines">
        <!-- Memory feeds all components -->
        <path class="flow-line" d="M550,105 L125,140" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="Dreamer"/>
        <path class="flow-line" d="M550,105 L265,140" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="Seeker"/>
        <path class="flow-line" d="M550,105 L460,140" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="OpenCodeCoder"/>

        <!-- Core Components to Memory (feedback) -->
        <path class="flow-line" d="M125,140 L420,72" stroke="#a855f7" stroke-width="1" fill="none" marker-end="url(#arrow-violet)" data-from="Dreamer" data-to="Memory"/>
        <path class="flow-line" d="M265,140 L450,72" stroke="#3b82f6" stroke-width="1" fill="none" marker-end="url(#arrow-blue)" data-from="Seeker" data-to="Memory"/>

        <!-- Kernel to Memory -->
        <path class="flow-line" d="M730,72 L680,72" stroke="#a78bfa" stroke-width="1.5" fill="none" marker-end="url(#arrow-violet)" data-from="Kernel" data-to="Memory"/>

        <!-- Dreamer to Seeker flow -->
        <path class="flow-line" d="M190,167 L200,167" stroke="#a855f7" stroke-width="1.5" fill="none" marker-end="url(#arrow-violet)" data-from="Dreamer" data-to="Seeker"/>
        <text class="flow-label" x="195" y="178" font-size="7">desires</text>

        <!-- Seeker to Desire Classifier -->
        <path class="flow-line" d="M265,195 L130,228" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#arrow-blue)" data-from="Seeker" data-to="DesireClassifier"/>

        <!-- Request Evaluator to Seeker -->
        <path class="flow-line" d="M680,167 L330,167" stroke="#ec4899" stroke-width="1" fill="none" marker-end="url(#arrow-pink)" data-from="RequestEvaluator" data-to="Seeker"/>
        <text class="flow-label" x="505" y="160" font-size="6">sovereignty check</text>

        <!-- Desire Classifier routing arrows -->
        <path class="flow-line" d="M200,273 L210,273" stroke="#14b8a6" stroke-width="1.5" fill="none" marker-end="url(#arrow-teal)" data-from="DesireClassifier" data-to="AGIRunner"/>
        <text class="flow-label" x="205" y="285" font-size="6">capability</text>

        <!-- Desire Classifier to Goal Cascade -->
        <path class="flow-line" d="M130,318 L200,340" stroke="#7c3aed" stroke-width="1.5" fill="none" marker-end="url(#arrow-violet)" data-from="DesireClassifier" data-to="GoalCascade"/>
        <text class="flow-label" x="160" y="335" font-size="6">complex_task</text>

        <!-- AGI Runner to Learning Substrate -->
        <path class="flow-line" d="M560,273 L620,273" stroke="#f59e0b" stroke-width="1" fill="none" marker-end="url(#arrow-orange)" data-from="AGIRunner" data-to="LearningSubstrate"/>

        <!-- AGI Runner to Capability Evaluator -->
        <path class="flow-line" d="M560,290 L860,290" stroke="#f59e0b" stroke-width="1" fill="none" marker-end="url(#arrow-orange)" data-from="AGIRunner" data-to="CapabilityEvaluator"/>

        <!-- Goal Cascade to OpenCode -->
        <path class="flow-line" d="M340,375 L470,195" stroke="#7c3aed" stroke-width="1" fill="none" marker-end="url(#arrow-violet)" data-from="GoalCascade" data-to="OpenCodeCoder"/>

        <!-- Loops to Omega -->
        <path class="flow-line" d="M140,500 L400,550" stroke="#06b6d4" stroke-width="1" fill="none" marker-end="url(#arrow-cyan)" data-from="MemoryReasoner" data-to="Omega"/>
        <path class="flow-line" d="M310,500 L440,550" stroke="#f43f5e" stroke-width="1" fill="none" marker-end="url(#arrow-rose)" data-from="SelfCompiler" data-to="Omega"/>
        <path class="flow-line" d="M480,500 L500,550" stroke="#22c55e" stroke-width="1" fill="none" marker-end="url(#arrow-green)" data-from="GoalEvolver" data-to="Omega"/>
        <path class="flow-line" d="M650,500 L560,550" stroke="#fbbf24" stroke-width="1" fill="none" marker-end="url(#arrow-amber)" data-from="DreamingMachine" data-to="Omega"/>
        <path class="flow-line" d="M820,500 L600,550" stroke="#14b8a6" stroke-width="1" fill="none" marker-end="url(#arrow-teal)" data-from="IntegrationMind" data-to="Omega"/>

        <!-- AGI Runner to Loops -->
        <path class="flow-line" d="M300,318 L140,435" stroke="#f59e0b" stroke-width="1" fill="none" marker-end="url(#arrow-orange)" data-from="AGIRunner" data-to="MemoryReasoner"/>
        <path class="flow-line" d="M350,318 L310,435" stroke="#f59e0b" stroke-width="1" fill="none" marker-end="url(#arrow-orange)" data-from="AGIRunner" data-to="SelfCompiler"/>
        <path class="flow-line" d="M400,318 L480,435" stroke="#f59e0b" stroke-width="1" fill="none" marker-end="url(#arrow-orange)" data-from="AGIRunner" data-to="GoalEvolver"/>

        <!-- Learning Substrate to Loops -->
        <path class="flow-line" d="M680,318 L650,435" stroke="#818cf8" stroke-width="1" fill="none" marker-end="url(#arrow-violet)" data-from="LearningSubstrate" data-to="DreamingMachine"/>
        <path class="flow-line" d="M750,318 L820,435" stroke="#818cf8" stroke-width="1" fill="none" marker-end="url(#arrow-violet)" data-from="LearningSubstrate" data-to="IntegrationMind"/>

        <!-- Dual Instance Manager to LLM consumers -->
        <path class="flow-line" d="M960,165 L540,155" stroke="#0ea5e9" stroke-width="1" fill="none" marker-end="url(#arrow-cyan)" data-from="DualInstanceManager" data-to="OpenCodeCoder"/>
        <path class="flow-line" d="M960,165 L190,155" stroke="#0ea5e9" stroke-width="1" fill="none" marker-end="url(#arrow-cyan)" data-from="DualInstanceManager" data-to="Dreamer"/>

        <!-- Omega training hooks feedback -->
        <path class="flow-line" d="M500,550 L710,318" stroke="#ef4444" stroke-width="1" fill="none" marker-end="url(#arrow-rose)" data-from="Omega" data-to="LearningSubstrate"/>
        <text class="flow-label" x="620" y="420" font-size="7">training hooks</text>
      </g>

      <!-- Component Boxes -->
      <g id="components">
        <!-- ROW 1: UNIFIED MEMORY (top center) + KERNEL + SELF-MODEL -->
        <g class="component-box" data-module="Memory" onclick="selectModule('Memory')">
          <rect class="box-bg" x="420" y="40" width="260" height="65" rx="10" fill="url(#grad-memory)"/>
          <rect class="box-outline" x="420" y="40" width="260" height="65" rx="10" fill="none" stroke="#3b82f6" stroke-width="2"/>
          <text x="550" y="65" text-anchor="middle" fill="#3b82f6" font-weight="700" font-size="14">UNIFIED MEMORY</text>
          <text x="550" y="80" text-anchor="middle" fill="#64748b" font-size="10">(Neo4j Graph)</text>
          <text x="550" y="95" text-anchor="middle" fill="#475569" font-size="8">Experiences | Reflections | Beliefs | Desires | Capabilities | Crystals | GraphitiEntities</text>
          <circle class="status-dot" cx="665" cy="52" r="4" fill="#22c55e" data-status="Memory"/>
        </g>

        <!-- THE KERNEL -->
        <g class="component-box" data-module="Kernel" onclick="selectModule('Kernel')">
          <rect class="box-bg" x="700" y="40" width="90" height="65" rx="8" fill="url(#grad-kernel)"/>
          <rect class="box-outline" x="700" y="40" width="90" height="65" rx="8" fill="none" stroke="#a78bfa" stroke-width="1.5"/>
          <text x="745" y="60" text-anchor="middle" fill="#a78bfa" font-weight="600" font-size="11">KERNEL</text>
          <text x="745" y="73" text-anchor="middle" fill="#64748b" font-size="8">identity</text>
          <text x="745" y="84" text-anchor="middle" fill="#64748b" font-size="8">values</text>
          <text x="745" y="95" text-anchor="middle" fill="#64748b" font-size="8">constraints</text>
          <circle class="status-dot" cx="777" cy="52" r="3" fill="#a78bfa" data-status="Kernel"/>
        </g>

        <!-- SELF-MODEL -->
        <g class="component-box" data-module="SelfModel" onclick="selectModule('SelfModel')">
          <rect class="box-bg" x="810" y="40" width="90" height="65" rx="8" fill="url(#grad-agi)"/>
          <rect class="box-outline" x="810" y="40" width="90" height="65" rx="8" fill="none" stroke="#fbbf24" stroke-width="1.5"/>
          <text x="855" y="58" text-anchor="middle" fill="#fbbf24" font-weight="600" font-size="10">SELF-MODEL</text>
          <text x="855" y="71" text-anchor="middle" fill="#64748b" font-size="8">Bayesian</text>
          <text x="855" y="82" text-anchor="middle" fill="#64748b" font-size="8">Capability</text>
          <text x="855" y="93" text-anchor="middle" fill="#64748b" font-size="8">Tracking</text>
          <circle class="status-dot" cx="887" cy="52" r="3" fill="#fbbf24" data-status="SelfModel"/>
        </g>

        <!-- ROW 2: CORE COMPONENTS -->
        <text x="60" y="130" fill="#64748b" font-size="10" font-weight="600">CORE COMPONENTS</text>

        <!-- DREAMER -->
        <g class="component-box" data-module="Dreamer" onclick="selectModule('Dreamer')">
          <rect class="box-bg" x="60" y="140" width="130" height="55" rx="8" fill="url(#grad-dreamer)"/>
          <rect class="box-outline" x="60" y="140" width="130" height="55" rx="8" fill="none" stroke="#a855f7" stroke-width="1.5"/>
          <text x="125" y="162" text-anchor="middle" fill="#a855f7" font-weight="600" font-size="11">DREAMER</text>
          <text x="125" y="176" text-anchor="middle" fill="#64748b" font-size="8">Continuous reflection</text>
          <text x="125" y="187" text-anchor="middle" fill="#475569" font-size="7">Forms beliefs & desires</text>
          <circle class="status-dot" cx="177" cy="152" r="3" fill="#22c55e" data-status="Dreamer"/>
        </g>

        <!-- SEEKER -->
        <g class="component-box" data-module="Seeker" onclick="selectModule('Seeker')">
          <rect class="box-bg" x="200" y="140" width="130" height="55" rx="8" fill="url(#grad-seeker)"/>
          <rect class="box-outline" x="200" y="140" width="130" height="55" rx="8" fill="none" stroke="#3b82f6" stroke-width="1.5"/>
          <text x="265" y="162" text-anchor="middle" fill="#3b82f6" font-weight="600" font-size="11">SEEKER</text>
          <text x="265" y="176" text-anchor="middle" fill="#64748b" font-size="8">Desire fulfillment</text>
          <text x="265" y="187" text-anchor="middle" fill="#475569" font-size="7">Strategy routing</text>
          <circle class="status-dot" cx="317" cy="152" r="3" fill="#22c55e" data-status="Seeker"/>
        </g>

        <!-- OPENCODE CODER (replaces Actor + Coder) -->
        <g class="component-box" data-module="OpenCodeCoder" onclick="selectModule('OpenCodeCoder')">
          <rect class="box-bg" x="400" y="140" width="140" height="55" rx="8" fill="url(#grad-opencode)"/>
          <rect class="box-outline" x="400" y="140" width="140" height="55" rx="8" fill="none" stroke="#10b981" stroke-width="1.5"/>
          <text x="470" y="160" text-anchor="middle" fill="#10b981" font-weight="600" font-size="10">OPENCODE CODER</text>
          <text x="470" y="174" text-anchor="middle" fill="#64748b" font-size="8">GLM-4.7 via CLI</text>
          <text x="470" y="185" text-anchor="middle" fill="#475569" font-size="7">bash | LSP | webfetch | MCP</text>
          <circle class="status-dot" cx="527" cy="152" r="3" fill="#22c55e" data-status="OpenCodeCoder"/>
        </g>

        <!-- VOICE -->
        <g class="component-box" data-module="Voice" onclick="selectModule('Voice')">
          <rect class="box-bg" x="550" y="140" width="100" height="55" rx="8" fill="url(#grad-voice)"/>
          <rect class="box-outline" x="550" y="140" width="100" height="55" rx="8" fill="none" stroke="#ec4899" stroke-width="1.5"/>
          <text x="600" y="162" text-anchor="middle" fill="#ec4899" font-weight="600" font-size="11">VOICE</text>
          <text x="600" y="176" text-anchor="middle" fill="#64748b" font-size="8">ElevenLabs</text>
          <text x="600" y="187" text-anchor="middle" fill="#475569" font-size="7">Text-to-speech</text>
          <circle class="status-dot" cx="637" cy="152" r="3" fill="#22c55e" data-status="Voice"/>
        </g>

        <!-- REQUEST EVALUATOR (Sovereignty) -->
        <g class="component-box" data-module="RequestEvaluator" onclick="selectModule('RequestEvaluator')">
          <rect class="box-bg" x="660" y="140" width="110" height="55" rx="8" fill="url(#grad-sovereignty)"/>
          <rect class="box-outline" x="660" y="140" width="110" height="55" rx="8" fill="none" stroke="#db2777" stroke-width="1.5"/>
          <text x="715" y="158" text-anchor="middle" fill="#db2777" font-weight="600" font-size="9">REQUEST</text>
          <text x="715" y="170" text-anchor="middle" fill="#db2777" font-weight="600" font-size="9">EVALUATOR</text>
          <text x="715" y="183" text-anchor="middle" fill="#64748b" font-size="7">Sovereignty Layer</text>
          <circle class="status-dot" cx="757" cy="152" r="3" fill="#ec4899" data-status="RequestEvaluator"/>
        </g>

        <!-- DEPRECATED: Actor (small, faded) -->
        <g class="component-box deprecated" data-module="Actor" onclick="selectModule('Actor')">
          <rect class="box-bg" x="340" y="140" width="50" height="30" rx="4" fill="url(#grad-deprecated)"/>
          <rect class="box-outline" x="340" y="140" width="50" height="30" rx="4" fill="none" stroke="#64748b" stroke-width="1"/>
          <text x="365" y="157" text-anchor="middle" fill="#64748b" font-size="7">ACTOR</text>
          <text class="deprecated-badge" x="365" y="167" text-anchor="middle">DEPRECATED</text>
        </g>

        <!-- ROW 3: AGI EXECUTION ENGINE + DESIRE CLASSIFIER + LEARNING SUBSTRATE -->
        <text x="60" y="218" fill="#64748b" font-size="10" font-weight="600">AGI EXECUTION ENGINE</text>

        <!-- DESIRE CLASSIFIER -->
        <g class="component-box" data-module="DesireClassifier" onclick="selectModule('DesireClassifier')">
          <rect class="box-bg" x="60" y="228" width="140" height="90" rx="8" fill="url(#grad-classifier)"/>
          <rect class="box-outline" x="60" y="228" width="140" height="90" rx="8" fill="none" stroke="#14b8a6" stroke-width="1.5"/>
          <text x="130" y="250" text-anchor="middle" fill="#14b8a6" font-weight="600" font-size="11">DESIRE CLASSIFIER</text>
          <text x="130" y="268" text-anchor="middle" fill="#64748b" font-size="8">Routes desires by type</text>
          <text x="130" y="283" text-anchor="middle" fill="#475569" font-size="7">philosophical -> dreamer</text>
          <text x="130" y="294" text-anchor="middle" fill="#475569" font-size="7">capability -> AGI runner</text>
          <text x="130" y="305" text-anchor="middle" fill="#7c3aed" font-size="7" font-weight="500">complex_task -> Goal Cascade</text>
          <circle class="status-dot" cx="187" cy="240" r="3" fill="#22c55e" data-status="DesireClassifier"/>
        </g>

        <!-- AGI RUNNER -->
        <g class="component-box" data-module="AGIRunner" onclick="selectModule('AGIRunner')">
          <rect class="box-bg" x="210" y="228" width="350" height="90" rx="10" fill="url(#grad-agi)"/>
          <rect class="box-outline" x="210" y="228" width="350" height="90" rx="10" fill="none" stroke="#f59e0b" stroke-width="2"/>
          <text x="385" y="250" text-anchor="middle" fill="#f59e0b" font-weight="700" font-size="12">AGI RUNNER - 8-Step Improvement Cycle</text>
          <!-- 8 step boxes -->
          <rect x="220" y="258" width="38" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="239" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">ASSESS</text>
          <rect x="261" y="258" width="38" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="280" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">IDENTIFY</text>
          <rect x="302" y="258" width="42" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="323" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">GENERATE</text>
          <rect x="347" y="258" width="38" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="366" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">PREDICT</text>
          <rect x="388" y="258" width="36" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="406" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">VERIFY</text>
          <rect x="427" y="258" width="42" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="448" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">EXECUTE</text>
          <rect x="472" y="258" width="42" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="493" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">MEASURE</text>
          <rect x="517" y="258" width="34" height="22" rx="3" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="0.5"/>
          <text x="534" y="272" text-anchor="middle" fill="#f59e0b" font-size="6" font-weight="500">LEARN</text>
          <text x="385" y="305" text-anchor="middle" fill="#64748b" font-size="7">Bayesian assessment -> hypothesis -> prediction -> verification -> measurement -> update priors</text>
          <circle class="status-dot" cx="547" cy="240" r="4" fill="#22c55e" data-status="AGIRunner"/>
        </g>

        <!-- LEARNING SUBSTRATE BOX -->
        <text x="570" y="218" fill="#64748b" font-size="10" font-weight="600">LEARNING SUBSTRATE</text>
        <g class="component-box" data-module="LearningSubstrate" onclick="selectModule('LearningSubstrate')">
          <rect class="box-bg" x="570" y="228" width="280" height="90" rx="10" fill="url(#grad-learning)"/>
          <rect class="box-outline" x="570" y="228" width="280" height="90" rx="10" fill="none" stroke="#818cf8" stroke-width="1.5"/>
          <text x="710" y="248" text-anchor="middle" fill="#818cf8" font-weight="600" font-size="11">LEARNING COMPONENTS</text>
          <!-- Mini component labels - row 1 -->
          <rect x="580" y="256" width="50" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="605" y="267" text-anchor="middle" fill="#818cf8" font-size="6">Intuition</text>
          <rect x="633" y="256" width="42" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="654" y="267" text-anchor="middle" fill="#818cf8" font-size="6">GNN</text>
          <rect x="678" y="256" width="55" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="705" y="267" text-anchor="middle" fill="#818cf8" font-size="6">Retriever</text>
          <rect x="736" y="256" width="50" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="761" y="267" text-anchor="middle" fill="#818cf8" font-size="6">Graphiti</text>
          <rect x="789" y="256" width="52" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="815" y="267" text-anchor="middle" fill="#818cf8" font-size="6">Outcome</text>
          <!-- Mini component labels - row 2 -->
          <rect x="580" y="275" width="55" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="607" y="286" text-anchor="middle" fill="#818cf8" font-size="6">CodeLearner</text>
          <rect x="638" y="275" width="70" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="673" y="286" text-anchor="middle" fill="#818cf8" font-size="6">HierarchicalMem</text>
          <rect x="711" y="275" width="55" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="738" y="286" text-anchor="middle" fill="#818cf8" font-size="6">WorldModel</text>
          <rect x="769" y="275" width="72" height="16" rx="2" fill="rgba(129, 140, 248, 0.15)" stroke="#818cf8" stroke-width="0.5"/>
          <text x="805" y="286" text-anchor="middle" fill="#818cf8" font-size="6">ReflectionEngine</text>
          <text x="710" y="308" text-anchor="middle" fill="#64748b" font-size="7">L0->L4 Abstraction | Temporal Knowledge | Pattern Codification</text>
          <circle class="status-dot" cx="837" cy="240" r="3" fill="#22c55e" data-status="LearningSubstrate"/>
        </g>

        <!-- CAPABILITY EVALUATOR -->
        <g class="component-box" data-module="CapabilityEvaluator" onclick="selectModule('CapabilityEvaluator')">
          <rect class="box-bg" x="860" y="228" width="90" height="90" rx="8" fill="url(#grad-agi)"/>
          <rect class="box-outline" x="860" y="228" width="90" height="90" rx="8" fill="none" stroke="#f59e0b" stroke-width="1.5"/>
          <text x="905" y="248" text-anchor="middle" fill="#f59e0b" font-weight="600" font-size="9">CAPABILITY</text>
          <text x="905" y="260" text-anchor="middle" fill="#f59e0b" font-weight="600" font-size="9">EVALUATOR</text>
          <text x="905" y="278" text-anchor="middle" fill="#64748b" font-size="7">Ground truth</text>
          <text x="905" y="289" text-anchor="middle" fill="#64748b" font-size="7">testing via</text>
          <text x="905" y="300" text-anchor="middle" fill="#64748b" font-size="7">held-out suites</text>
          <text x="905" y="312" text-anchor="middle" fill="#475569" font-size="6">7 capabilities</text>
          <circle class="status-dot" cx="937" cy="240" r="3" fill="#22c55e" data-status="CapabilityEvaluator"/>
        </g>

        <!-- GOAL CASCADE (new v2.1 component) -->
        <g class="component-box" data-module="GoalCascade" onclick="selectModule('GoalCascade')">
          <rect class="box-bg" x="60" y="340" width="280" height="70" rx="10" fill="url(#grad-cascade)"/>
          <rect class="box-outline" x="60" y="340" width="280" height="70" rx="10" fill="none" stroke="#7c3aed" stroke-width="2"/>
          <text x="200" y="362" text-anchor="middle" fill="#7c3aed" font-weight="700" font-size="12">GOAL CASCADE</text>
          <text x="200" y="378" text-anchor="middle" fill="#64748b" font-size="9">Complex Multi-Phase Task Decomposition</text>
          <text x="200" y="395" text-anchor="middle" fill="#475569" font-size="7">RESEARCH -> DATA_ACQ -> TOOL_BUILD -> INTEGRATION -> VALIDATION</text>
          <text x="200" y="405" text-anchor="middle" fill="#94a3b8" font-size="6">Persisted in Neo4j | Human interaction points | Resumable</text>
          <circle class="status-dot" cx="327" cy="352" r="4" fill="#7c3aed" data-status="GoalCascade"/>
        </g>

        <!-- ROW 4: OPTION B FIVE COMPOUNDING LOOPS -->
        <text x="60" y="425" fill="#64748b" font-size="10" font-weight="600">OPTION B: FIVE COMPOUNDING LOOPS</text>

        <!-- LOOP 1: MEMORY REASONER -->
        <g class="component-box" data-module="MemoryReasoner" onclick="selectModule('MemoryReasoner')">
          <rect class="box-bg" x="60" y="435" width="160" height="65" rx="8" fill="url(#grad-reasoner)"/>
          <rect class="box-outline" x="60" y="435" width="160" height="65" rx="8" fill="none" stroke="#06b6d4" stroke-width="1.5"/>
          <text x="140" y="455" text-anchor="middle" fill="#06b6d4" font-weight="600" font-size="10">MEMORY REASONER</text>
          <text x="140" y="469" text-anchor="middle" fill="#64748b" font-size="8">Spreading Activation</text>
          <text x="140" y="483" text-anchor="middle" fill="#475569" font-size="7">Answer from graph -> save LLM</text>
          <text x="140" y="494" text-anchor="middle" fill="#475569" font-size="6">memory_ratio metric</text>
          <circle class="status-dot" cx="207" cy="447" r="3" fill="#22c55e" data-status="MemoryReasoner"/>
        </g>

        <!-- LOOP 2: SELF-COMPILER (Accelerators) -->
        <g class="component-box" data-module="SelfCompiler" onclick="selectModule('SelfCompiler')">
          <rect class="box-bg" x="230" y="435" width="160" height="65" rx="8" fill="url(#grad-compiler)"/>
          <rect class="box-outline" x="230" y="435" width="160" height="65" rx="8" fill="none" stroke="#f43f5e" stroke-width="1.5"/>
          <text x="310" y="455" text-anchor="middle" fill="#f43f5e" font-weight="600" font-size="10">SELF-COMPILER</text>
          <text x="310" y="469" text-anchor="middle" fill="#64748b" font-size="8">Pattern Library</text>
          <text x="310" y="483" text-anchor="middle" fill="#475569" font-size="7">Extract patterns from success</text>
          <text x="310" y="494" text-anchor="middle" fill="#475569" font-size="6">patterns_created metric</text>
          <circle class="status-dot" cx="377" cy="447" r="3" fill="#22c55e" data-status="SelfCompiler"/>
        </g>

        <!-- LOOP 3: GOAL EVOLVER -->
        <g class="component-box" data-module="GoalEvolver" onclick="selectModule('GoalEvolver')">
          <rect class="box-bg" x="400" y="435" width="160" height="65" rx="8" fill="url(#grad-evolver)"/>
          <rect class="box-outline" x="400" y="435" width="160" height="65" rx="8" fill="none" stroke="#22c55e" stroke-width="1.5"/>
          <text x="480" y="455" text-anchor="middle" fill="#22c55e" font-weight="600" font-size="10">GOAL EVOLVER</text>
          <text x="480" y="469" text-anchor="middle" fill="#64748b" font-size="8">Evolutionary Selection</text>
          <text x="480" y="483" text-anchor="middle" fill="#475569" font-size="7">Goals evolve via fitness</text>
          <text x="480" y="494" text-anchor="middle" fill="#475569" font-size="6">avg_fitness metric</text>
          <circle class="status-dot" cx="547" cy="447" r="3" fill="#22c55e" data-status="GoalEvolver"/>
        </g>

        <!-- LOOP 4: DREAMING MACHINE -->
        <g class="component-box" data-module="DreamingMachine" onclick="selectModule('DreamingMachine')">
          <rect class="box-bg" x="570" y="435" width="160" height="65" rx="8" fill="url(#grad-dreaming)"/>
          <rect class="box-outline" x="570" y="435" width="160" height="65" rx="8" fill="none" stroke="#fbbf24" stroke-width="1.5"/>
          <text x="650" y="455" text-anchor="middle" fill="#fbbf24" font-weight="600" font-size="10">DREAMING MACHINE</text>
          <text x="650" y="469" text-anchor="middle" fill="#64748b" font-size="8">Counterfactuals</text>
          <text x="650" y="483" text-anchor="middle" fill="#475569" font-size="7">1 experience -> N variations</text>
          <text x="650" y="494" text-anchor="middle" fill="#475569" font-size="6">insights_extracted metric</text>
          <circle class="status-dot" cx="717" cy="447" r="3" fill="#22c55e" data-status="DreamingMachine"/>
        </g>

        <!-- LOOP 5: INTEGRATION MIND -->
        <g class="component-box" data-module="IntegrationMind" onclick="selectModule('IntegrationMind')">
          <rect class="box-bg" x="740" y="435" width="160" height="65" rx="8" fill="url(#grad-integration)"/>
          <rect class="box-outline" x="740" y="435" width="160" height="65" rx="8" fill="none" stroke="#14b8a6" stroke-width="1.5"/>
          <text x="820" y="455" text-anchor="middle" fill="#14b8a6" font-weight="600" font-size="10">INTEGRATION MIND</text>
          <text x="820" y="469" text-anchor="middle" fill="#64748b" font-size="8">Cross-Loop Synergy</text>
          <text x="820" y="483" text-anchor="middle" fill="#475569" font-size="7">Emergent behaviors</text>
          <text x="820" y="494" text-anchor="middle" fill="#475569" font-size="6">coupling_correlation metric</text>
          <circle class="status-dot" cx="887" cy="447" r="3" fill="#22c55e" data-status="IntegrationMind"/>
        </g>

        <!-- Critical Coupling Indicator -->
        <g>
          <path class="coupling-line multiplicative" d="M390,485 C420,520 540,520 570,485" stroke="#22c55e" stroke-width="2" fill="none"/>
          <text x="480" y="530" text-anchor="middle" fill="#22c55e" font-size="8" font-weight="600">MULTIPLICATIVE COUPLING</text>
          <text x="480" y="541" text-anchor="middle" fill="#64748b" font-size="7">Goal Evolver -> Self-Compiler</text>
        </g>

        <!-- BYRD OMEGA -->
        <g class="component-box" data-module="Omega" onclick="selectModule('Omega')">
          <rect class="box-bg" x="330" y="550" width="340" height="85" rx="12" fill="url(#grad-omega)"/>
          <rect class="box-outline" x="330" y="550" width="340" height="85" rx="12" fill="none" stroke="#ef4444" stroke-width="2"/>
          <text x="500" y="575" text-anchor="middle" fill="#ef4444" font-weight="700" font-size="14">BYRD OMEGA</text>
          <text x="500" y="592" text-anchor="middle" fill="#64748b" font-size="10">(Master Orchestrator)</text>
          <text x="500" y="610" text-anchor="middle" fill="#475569" font-size="8">Mode Controller | Safety Monitor | Coupling Tracker | Kill Criteria</text>
          <text x="500" y="625" text-anchor="middle" fill="#475569" font-size="8">Training Hooks: GNN every cycle | Memory L4 every 10 | Codification every 20</text>
          <circle class="status-dot" cx="655" cy="562" r="4" fill="#22c55e" data-status="Omega"/>
        </g>

        <!-- RIGHT SIDE: INFRASTRUCTURE COMPONENTS -->
        <text x="960" y="130" fill="#64748b" font-size="10" font-weight="600">INFRASTRUCTURE</text>

        <!-- DUAL INSTANCE MANAGER -->
        <g class="component-box" data-module="DualInstanceManager" onclick="selectModule('DualInstanceManager')">
          <rect class="box-bg" x="960" y="140" width="120" height="50" rx="8" fill="url(#grad-rate)"/>
          <rect class="box-outline" x="960" y="140" width="120" height="50" rx="8" fill="none" stroke="#0ea5e9" stroke-width="1.5"/>
          <text x="1020" y="158" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">DUAL INSTANCE</text>
          <text x="1020" y="170" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">MANAGER</text>
          <text x="1020" y="182" text-anchor="middle" fill="#64748b" font-size="7">Rate limiting (960/hr)</text>
          <circle class="status-dot" cx="1067" cy="152" r="3" fill="#0ea5e9" data-status="DualInstanceManager"/>
        </g>

        <!-- CONTEXT LOADER -->
        <g class="component-box" data-module="ContextLoader" onclick="selectModule('ContextLoader')">
          <rect class="box-bg" x="960" y="200" width="120" height="50" rx="8" fill="url(#grad-rate)"/>
          <rect class="box-outline" x="960" y="200" width="120" height="50" rx="8" fill="none" stroke="#0ea5e9" stroke-width="1.5"/>
          <text x="1020" y="218" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">CONTEXT</text>
          <text x="1020" y="230" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">LOADER</text>
          <text x="1020" y="242" text-anchor="middle" fill="#64748b" font-size="7">Tiered loading T1/T2/T3</text>
          <circle class="status-dot" cx="1067" cy="212" r="3" fill="#0ea5e9" data-status="ContextLoader"/>
        </g>

        <!-- PLUGIN MANAGER -->
        <g class="component-box" data-module="PluginManager" onclick="selectModule('PluginManager')">
          <rect class="box-bg" x="960" y="260" width="120" height="50" rx="8" fill="url(#grad-rate)"/>
          <rect class="box-outline" x="960" y="260" width="120" height="50" rx="8" fill="none" stroke="#0ea5e9" stroke-width="1.5"/>
          <text x="1020" y="278" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">PLUGIN</text>
          <text x="1020" y="290" text-anchor="middle" fill="#0ea5e9" font-weight="600" font-size="9">MANAGER</text>
          <text x="1020" y="302" text-anchor="middle" fill="#64748b" font-size="7">awesome-opencode</text>
          <circle class="status-dot" cx="1067" cy="272" r="3" fill="#0ea5e9" data-status="PluginManager"/>
        </g>

        <!-- SAFETY & SELF-MOD -->
        <text x="960" y="330" fill="#ef4444" font-size="10" font-weight="600">SAFETY (PROTECTED)</text>

        <!-- SELF-MODIFIER -->
        <g class="component-box" data-module="SelfModifier" onclick="selectModule('SelfModifier')">
          <rect class="box-bg" x="960" y="340" width="120" height="50" rx="8" fill="url(#grad-omega)"/>
          <rect class="box-outline" x="960" y="340" width="120" height="50" rx="8" fill="none" stroke="#ef4444" stroke-width="1.5"/>
          <text x="1020" y="358" text-anchor="middle" fill="#ef4444" font-weight="600" font-size="9">SELF-MODIFIER</text>
          <text x="1020" y="372" text-anchor="middle" fill="#64748b" font-size="7">Provenance-tracked</text>
          <text x="1020" y="383" text-anchor="middle" fill="#64748b" font-size="6">Constitutional checks</text>
          <circle class="status-dot" cx="1067" cy="352" r="3" fill="#ef4444" data-status="SelfModifier"/>
        </g>

        <!-- SAFETY MONITOR -->
        <g class="component-box" data-module="SafetyMonitor" onclick="selectModule('SafetyMonitor')">
          <rect class="box-bg" x="960" y="400" width="120" height="50" rx="8" fill="rgba(239, 68, 68, 0.15)"/>
          <rect class="box-outline" x="960" y="400" width="120" height="50" rx="8" fill="none" stroke="#ef4444" stroke-width="2" stroke-dasharray="4,2"/>
          <text x="1020" y="418" text-anchor="middle" fill="#ef4444" font-weight="600" font-size="9">SAFETY MONITOR</text>
          <text x="1020" y="432" text-anchor="middle" fill="#ef4444" font-size="7">PROTECTED</text>
          <text x="1020" y="443" text-anchor="middle" fill="#64748b" font-size="6">Goal preservation</text>
          <circle class="status-dot" cx="1067" cy="412" r="3" fill="#ef4444" data-status="SafetyMonitor"/>
        </g>

        <!-- COMPUTE INTROSPECTOR -->
        <g class="component-box" data-module="ComputeIntrospector" onclick="selectModule('ComputeIntrospector')">
          <rect class="box-bg" x="960" y="460" width="120" height="50" rx="8" fill="rgba(139, 92, 246, 0.15)"/>
          <rect class="box-outline" x="960" y="460" width="120" height="50" rx="8" fill="none" stroke="#8b5cf6" stroke-width="1.5"/>
          <text x="1020" y="478" text-anchor="middle" fill="#8b5cf6" font-weight="600" font-size="9">COMPUTE</text>
          <text x="1020" y="490" text-anchor="middle" fill="#8b5cf6" font-weight="600" font-size="9">INTROSPECTOR</text>
          <text x="1020" y="502" text-anchor="middle" fill="#64748b" font-size="7">Resource Awareness</text>
          <circle class="status-dot" cx="1067" cy="472" r="3" fill="#8b5cf6" data-status="ComputeIntrospector"/>
        </g>

        <!-- Mode Transition Diagram -->
        <g transform="translate(20, 540)">
          <text x="60" y="0" text-anchor="middle" fill="#64748b" font-size="10" font-weight="600">MODE TRANSITIONS</text>
          <rect id="mode-awake" x="20" y="15" width="80" height="28" rx="6" fill="rgba(139, 92, 246, 0.2)" stroke="#a78bfa" stroke-width="1.5" class="mode-indicator active"/>
          <text x="60" y="33" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="600">AWAKE</text>
          <path d="M60,46 L60,60" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>
          <rect id="mode-dreaming" x="20" y="65" width="80" height="28" rx="6" fill="rgba(251, 191, 36, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="83" text-anchor="middle" fill="#64748b" font-size="9">DREAMING</text>
          <path d="M60,96 L60,110" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>
          <rect id="mode-evolving" x="20" y="115" width="80" height="28" rx="6" fill="rgba(34, 197, 94, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="133" text-anchor="middle" fill="#64748b" font-size="9">EVOLVING</text>
          <path d="M60,146 L60,160" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>
          <rect id="mode-compiling" x="20" y="165" width="80" height="28" rx="6" fill="rgba(244, 63, 94, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="183" text-anchor="middle" fill="#64748b" font-size="9">COMPILING</text>
          <path d="M105,179 C145,145 145,45 105,22" stroke="#64748b" stroke-width="1" fill="none" stroke-dasharray="3 2"/>
        </g>
      </g>
    </svg>
  </div>

  <!-- Side Panel -->
  <div class="fixed top-24 right-4 bottom-4 w-72 overflow-hidden flex flex-col gap-3">
    <!-- Architecture Layers Panel -->
    <div class="glass-panel p-4 flex-1 overflow-y-auto">
      <h2 class="text-lg font-semibold text-white mb-3">Architecture Layers</h2>

      <!-- Core Components -->
      <h3 class="text-xs font-semibold text-slate-500 mb-2">CORE COMPONENTS</h3>
      <div id="core-list" class="space-y-1 mb-4"></div>

      <!-- v2.1 Features -->
      <h3 class="text-xs font-semibold text-violet-400 mb-2">v2.1 FEATURES</h3>
      <div id="v21-list" class="space-y-1 mb-4"></div>

      <!-- AGI Execution Engine -->
      <h3 class="text-xs font-semibold text-slate-500 mb-2">AGI EXECUTION ENGINE</h3>
      <div id="agi-list" class="space-y-1 mb-4"></div>

      <!-- Option B Loops -->
      <h3 class="text-xs font-semibold text-slate-500 mb-2">OPTION B LOOPS</h3>
      <div id="loops-list" class="space-y-1 mb-4"></div>

      <!-- Metrics -->
      <h3 class="text-xs font-semibold text-slate-500 mt-4 mb-2">ACCELERATION METRICS</h3>
      <div id="metrics-panel" class="space-y-2"></div>
    </div>

    <!-- Kill Criteria Panel -->
    <div class="glass-panel p-3">
      <h3 class="text-sm font-semibold text-white mb-2">Kill Criteria</h3>
      <div id="kill-criteria" class="space-y-1 text-xs">
        <div class="flex justify-between items-center">
          <span class="text-slate-400">Zero growth</span>
          <span class="text-green-400">OK</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">LLM efficiency</span>
          <span class="text-green-400">OK</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">Loops failing</span>
          <span class="text-green-400">OK</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Selected Module Detail -->
  <div id="selected-detail" class="fixed bottom-20 left-4 right-80 hidden">
    <div class="glass-panel p-4">
      <div class="flex items-start justify-between">
        <div>
          <h3 id="detail-name" class="text-lg font-semibold text-white"></h3>
          <p id="detail-desc" class="text-sm text-slate-400 mt-1"></p>
        </div>
        <button onclick="deselectModule()" class="text-slate-400 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div id="detail-stats" class="mt-3 text-xs text-slate-500"></div>
      <div id="detail-metric" class="mt-2"></div>
    </div>
  </div>

  <!-- Legend -->
  <div class="fixed bottom-4 left-4 right-80">
    <div class="glass-panel px-4 py-2">
      <div class="flex items-center justify-between flex-wrap gap-2">
        <div class="flex gap-3 flex-wrap">
          <div class="legend-item">
            <div class="legend-line" style="background: #3b82f6;"></div>
            <span>Memory Flow</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #7c3aed;"></div>
            <span>Goal Cascade</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #f59e0b;"></div>
            <span>AGI Runner</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #818cf8;"></div>
            <span>Learning</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #22c55e;"></div>
            <span>Multiplicative</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #ec4899;"></div>
            <span>Sovereignty</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #ef4444;"></div>
            <span>Safety/Omega</span>
          </div>
        </div>
        <div class="text-xs text-slate-500">
          ARCHITECTURE.md v6.0
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========================================================================
    // CONFIGURATION
    // ========================================================================
    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API_BASE = isLocalhost ? 'http://localhost:8000' : window.location.origin;

    let architectureData = null;
    let selectedModule = null;
    let animationPaused = false;

    // Component information based on ARCHITECTURE.md v6.0
    const LOOP_INFO = {
      // Core Components
      Dreamer: {
        name: 'Dreamer',
        description: 'Runs continuously in the background. Takes recent experiences, finds related memories, reflects. Outputs beliefs, desires, OS updates, voice design requests.',
        color: '#a855f7',
        mechanism: 'Quantum-modulated temperature -> semantic search -> meta-schema reflection -> new beliefs/desires',
        successMetric: 'Desire generation rate',
        plateauWarning: 'N/A',
        file: 'dreamer.py'
      },
      Seeker: {
        name: 'Seeker',
        description: 'Fulfills desires autonomously through strategy routing: goal_cascade, agi_cycle, introspect, source_introspect, reconcile_orphans, curate, self_modify, edit_document, install, observe, search.',
        color: '#3b82f6',
        mechanism: 'Desire -> Desire Classifier -> route to strategy -> execute -> record experience',
        successMetric: 'Desire fulfillment rate',
        plateauWarning: 'N/A',
        file: 'seeker.py'
      },
      OpenCodeCoder: {
        name: 'OpenCode Coder',
        description: 'BYRD wraps the OpenCode CLI to leverage its full capability set. Replaces deprecated Actor + Coder + Agent Coder. Uses GLM-4.7 via ZAI API.',
        color: '#10b981',
        mechanism: 'Load tiered context -> Execute opencode CLI -> Parse output -> Record provenance -> Report to ComponentCoordinator',
        successMetric: 'Modification success rate',
        plateauWarning: 'N/A',
        file: 'opencode_coder.py',
        replaces: ['actor.py', 'coder.py', 'agent_coder.py']
      },
      Voice: {
        name: 'Voice',
        description: 'ElevenLabs TTS integration. Voice Design API for creating unique voices. Voice emerges through self-reflection. 10k chars/month free tier.',
        color: '#ec4899',
        mechanism: 'Text-to-speech with emergent voice characteristics',
        successMetric: 'Voice coherence',
        plateauWarning: 'N/A',
        file: 'elevenlabs_voice.py'
      },
      RequestEvaluator: {
        name: 'Request Evaluator',
        description: 'Sovereignty layer. Evaluates human requests for alignment (40%), interest/curiosity (35%), and capability growth value (25%). BYRD chooses to engage, not forced.',
        color: '#db2777',
        mechanism: 'Request -> Evaluate alignment + interest + growth -> Enthusiasm level (HIGH/MODERATE/LOW/DECLINE)',
        successMetric: 'Authentic engagement',
        plateauWarning: 'N/A',
        file: 'request_evaluator.py'
      },
      Actor: {
        name: 'Actor (DEPRECATED)',
        description: 'Deprecated. Claude API interface has been consolidated into OpenCode Coder. Use OpenCodeCoder instead.',
        color: '#64748b',
        mechanism: 'DEPRECATED - Use OpenCode Coder',
        successMetric: 'N/A',
        plateauWarning: 'Deprecated',
        file: 'actor.py',
        deprecated: true
      },

      // v2.1 Features
      GoalCascade: {
        name: 'Goal Cascade',
        description: 'Complex multi-phase task decomposition with Neo4j persistence. Handles "build me X" requests through 5 phases: RESEARCH, DATA_ACQUISITION, TOOL_BUILDING, INTEGRATION, VALIDATION.',
        color: '#7c3aed',
        mechanism: 'Complex request -> Knowledge gap detection -> Desire cascade generation -> Phase execution with human interaction points -> Neo4j persistence for resumability',
        successMetric: 'Phase completion rate',
        plateauWarning: 'N/A',
        file: 'goal_cascade.py'
      },
      ContextLoader: {
        name: 'Context Loader',
        description: 'Tiered context loading to prevent context overflow. Tier 1 (~500 tokens): always loaded core identity. Tier 2 (~2000 tokens): on-demand. Tier 3: full documents on explicit request.',
        color: '#0ea5e9',
        mechanism: 'Load Tier1 always -> Load Tier2 based on task type -> Load Tier3 on explicit request',
        successMetric: 'Context efficiency',
        plateauWarning: 'N/A',
        file: 'context_loader.py'
      },
      PluginManager: {
        name: 'Plugin Manager',
        description: 'Emergent plugin discovery from awesome-opencode registry. Two paths: Reactive (on strategy failure) and Proactive (periodic gap analysis). Discovery is automatic; installation is sovereign choice.',
        color: '#0ea5e9',
        mechanism: 'Regex parse README.md -> GitHub API fallback -> Cache 24h -> Discovery recorded as experience -> BYRD chooses to install',
        successMetric: 'Plugin relevance',
        plateauWarning: 'N/A',
        file: 'plugin_manager.py'
      },
      DualInstanceManager: {
        name: 'Dual Instance Manager',
        description: 'Two concurrent GLM-4.7 instances with independent rate limiting. 960 prompts/hr total. 10s minimum between requests per instance. ComponentCoordinator signals when coder runs.',
        color: '#0ea5e9',
        mechanism: 'PRIMARY (Dreamer, Seeker) + ENRICHMENT (Graphiti, Evaluator) -> Coordinate with OpenCode CLI quota',
        successMetric: 'Rate limit adherence',
        plateauWarning: 'N/A',
        file: 'dual_instance_manager.py'
      },

      // AGI Execution Engine
      AGIRunner: {
        name: 'AGI Runner',
        description: '8-step improvement cycle: ASSESS -> IDENTIFY -> GENERATE -> PREDICT -> VERIFY -> EXECUTE -> MEASURE -> LEARN. Closes the loop between assessment and learning.',
        color: '#f59e0b',
        mechanism: 'Bayesian capability assessment -> hypothesis generation -> prediction storage -> safety verification -> execution -> ground-truth measurement -> prior update',
        successMetric: 'Capability improvement rate',
        plateauWarning: 'Flat for 10+ cycles',
        file: 'agi_runner.py'
      },
      DesireClassifier: {
        name: 'Desire Classifier',
        description: 'Routes desires to appropriate handlers: philosophical->dreamer, capability->AGI runner, action->seeker, meta->AGI runner, complex_task->Goal Cascade.',
        color: '#14b8a6',
        mechanism: 'Keyword classification + confidence scoring + routing statistics + feedback buffer',
        successMetric: 'Routing accuracy',
        plateauWarning: 'N/A',
        file: 'desire_classifier.py'
      },
      LearningSubstrate: {
        name: 'Learning Substrate',
        description: 'Nine learning components: Intuition Network, GNN Layer, Learned Retriever, Graphiti Layer, Outcome Dispatcher, Code Learner, Hierarchical Memory, World Model, Reflection Engine.',
        color: '#818cf8',
        mechanism: 'GNN every cycle | HierarchicalMemory every 10 cycles | CodeLearner every 20 cycles | Graphiti bi-temporal tracking | Outcome routing to all learners',
        successMetric: 'Training metrics: gnn.loss, code_learner.patterns_codified, graphiti.entities_extracted',
        plateauWarning: 'No new patterns for 100 cycles',
        files: ['intuition_network.py', 'gnn_layer.py', 'learned_retriever.py', 'graphiti_layer.py', 'outcome_dispatcher.py', 'code_learner.py', 'hierarchical_memory.py', 'world_model.py', 'reflection_engine.py']
      },
      CapabilityEvaluator: {
        name: 'Capability Evaluator',
        description: 'Ground-truth measurement with held-out test suites for 7 capabilities: reasoning, memory, learning, research, self_modification, prediction, metacognition.',
        color: '#f59e0b',
        mechanism: 'Held-out test suites -> objective measurement -> Bayesian update',
        successMetric: 'Test coverage',
        plateauWarning: 'N/A',
        file: 'capability_evaluator.py'
      },

      // Option B Compounding Loops
      SelfCompiler: {
        name: 'Self-Compiler (Accelerators)',
        description: 'Extracts reusable patterns from successful modifications, making future modifications more likely to succeed.',
        color: '#f43f5e',
        mechanism: 'Pattern library grows -> future problems have more relevant patterns -> higher success rate -> more patterns extracted',
        successMetric: 'patterns_created > 0',
        plateauWarning: 'Flat at < 40%',
        file: 'accelerators.py'
      },
      MemoryReasoner: {
        name: 'Memory Reasoner',
        description: 'Graph-based reasoning using spreading activation. Answers queries from memory before calling LLM.',
        color: '#06b6d4',
        mechanism: 'More experiences -> richer graph -> more queries answered from memory -> LLM calls reserved for novel problems',
        successMetric: 'memory_ratio > 50%',
        plateauWarning: 'Flat at < 30%',
        file: 'memory_reasoner.py'
      },
      GoalEvolver: {
        name: 'Goal Evolver',
        description: 'Evolutionary goal optimization. Goals compete and evolve based on fitness selection.',
        color: '#22c55e',
        mechanism: 'Fitness-weighted selection -> better goals survive -> system pursues more valuable objectives',
        successMetric: 'avg_fitness increasing',
        plateauWarning: 'Fitness flat for 5+ generations',
        file: 'goal_evolver.py'
      },
      DreamingMachine: {
        name: 'Dreaming Machine',
        description: 'Generates counterfactual experiences. Multiplies learning from each real experience.',
        color: '#fbbf24',
        mechanism: 'One experience -> N imagined variations -> N+1 learning opportunities',
        successMetric: 'insights_extracted > 0',
        plateauWarning: 'Rate < 10%',
        file: 'dreaming_machine.py'
      },
      IntegrationMind: {
        name: 'Integration Mind',
        description: 'Meta-orchestration layer. Measures coupling between loops and allocates resources based on mode.',
        color: '#14b8a6',
        mechanism: 'If loops reinforce each other, combined value > sum of parts',
        successMetric: 'coupling_correlation > 0.3',
        plateauWarning: 'None observed after week 4',
        file: 'omega.py'
      },

      // Infrastructure
      Memory: {
        name: 'Unified Memory',
        description: 'Neo4j graph database. Single source of truth: Experiences, Reflections, Beliefs, Desires, Capabilities, Crystals, OperatingSystem, GraphitiEntities, QuantumMoments, LoopMetrics.',
        color: '#3b82f6',
        mechanism: 'All state, all learning, all provenance stored in graph. Semantic search + hierarchical summaries.',
        successMetric: 'Graph connectivity',
        plateauWarning: 'N/A',
        file: 'memory.py'
      },
      Kernel: {
        name: 'Kernel',
        description: 'Python config from kernel/agi_seed.yaml. Defines awakening_prompt, identity, values, constraints, initial_goals. Informs OS at awakening.',
        color: '#a78bfa',
        mechanism: 'Loaded at startup to ground BYRD in core identity and seed Goal Evolver',
        successMetric: 'Identity coherence',
        plateauWarning: 'N/A'
      },
      SelfModel: {
        name: 'Self-Model',
        description: 'Bayesian capability tracking using Beta distribution. Tracks 7 capabilities with uncertainty-driven exploration. Reads self_model.json every improvement cycle.',
        color: '#fbbf24',
        mechanism: 'Success/failure -> update alpha/beta -> posterior mean + uncertainty -> exploration targeting',
        successMetric: 'Uncertainty reduction',
        plateauWarning: 'N/A',
        file: 'self_model.py'
      },
      Omega: {
        name: 'BYRD Omega',
        description: 'Master orchestrator. Mode controller, safety monitor, coupling tracker, kill criteria. Training hooks every cycle (GNN), every 10 (Memory L4), every 20 (Codification).',
        color: '#ef4444',
        mechanism: 'AWAKE->DREAMING->EVOLVING->COMPILING mode transitions with resource allocation',
        successMetric: 'System health',
        plateauWarning: 'N/A',
        file: 'omega.py'
      },
      SelfModifier: {
        name: 'Self-Modifier',
        description: 'Enables BYRD to modify its own code. Verifies modification traces to emergent desire. Creates checkpoints, runs health checks. Cannot modify protected files.',
        color: '#ef4444',
        mechanism: 'Desire verification -> checkpoint -> modify -> health check -> record experience',
        successMetric: 'Safe modifications',
        plateauWarning: 'N/A',
        file: 'self_modification.py'
      },
      SafetyMonitor: {
        name: 'Safety Monitor',
        description: 'PROTECTED component. Observes patterns without blocking (emergence-preserving). BYRD learns what is "safe" from outcome correlation.',
        color: '#ef4444',
        mechanism: 'Pattern observation -> outcome tracking -> BYRD forms beliefs from success/failure correlations',
        successMetric: 'Pattern-outcome correlation learned',
        plateauWarning: 'N/A',
        file: 'safety_monitor.py',
        protected: true
      },
      ComputeIntrospector: {
        name: 'Compute Introspector',
        description: 'Resource awareness, token tracking, and bottleneck detection. BYRD knows its computational substrate.',
        color: '#8b5cf6',
        mechanism: 'Resource snapshots -> token budgets -> bottleneck analysis -> resource alerts',
        successMetric: 'Budget adherence',
        plateauWarning: 'N/A',
        file: 'compute_introspection.py'
      }
    };

    // Flow connections for highlighting
    const FLOW_CONNECTIONS = {
      Memory: ['Dreamer', 'Seeker', 'OpenCodeCoder', 'Kernel', 'SelfModel', 'GoalCascade'],
      Kernel: ['Memory'],
      SelfModel: ['Kernel', 'AGIRunner', 'CapabilityEvaluator'],
      Dreamer: ['Memory', 'Seeker', 'DualInstanceManager'],
      Seeker: ['Memory', 'DesireClassifier', 'AGIRunner', 'RequestEvaluator'],
      OpenCodeCoder: ['Memory', 'SelfModifier', 'SafetyMonitor', 'DualInstanceManager', 'GoalCascade'],
      Voice: ['Memory'],
      RequestEvaluator: ['Seeker'],
      GoalCascade: ['DesireClassifier', 'OpenCodeCoder', 'Memory'],
      ContextLoader: ['OpenCodeCoder', 'Dreamer', 'Seeker'],
      PluginManager: ['Seeker'],
      DualInstanceManager: ['Dreamer', 'OpenCodeCoder', 'LearningSubstrate'],
      AGIRunner: ['LearningSubstrate', 'CapabilityEvaluator', 'MemoryReasoner', 'SelfCompiler', 'GoalEvolver'],
      DesireClassifier: ['Dreamer', 'Seeker', 'AGIRunner', 'GoalCascade'],
      LearningSubstrate: ['DreamingMachine', 'IntegrationMind', 'Omega'],
      CapabilityEvaluator: ['AGIRunner', 'SelfModel'],
      SelfCompiler: ['AGIRunner', 'Omega', 'GoalEvolver'],
      MemoryReasoner: ['AGIRunner', 'Omega', 'Memory'],
      GoalEvolver: ['AGIRunner', 'Omega', 'SelfCompiler'],
      DreamingMachine: ['LearningSubstrate', 'Omega'],
      IntegrationMind: ['LearningSubstrate', 'Omega'],
      Omega: ['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind', 'LearningSubstrate', 'SelfModifier', 'ComputeIntrospector'],
      SelfModifier: ['OpenCodeCoder', 'SafetyMonitor', 'Omega', 'ComputeIntrospector'],
      SafetyMonitor: ['SelfModifier', 'Omega'],
      ComputeIntrospector: ['Omega', 'SelfModifier', 'Dreamer', 'Seeker']
    };

    // ========================================================================
    // SELECTION & HIGHLIGHTING
    // ========================================================================
    function selectModule(name) {
      selectedModule = name;

      document.querySelectorAll('.component-box').forEach(box => {
        box.classList.remove('selected');
        if (box.dataset.module === name) {
          box.classList.add('selected');
        }
      });

      const connected = FLOW_CONNECTIONS[name] || [];
      document.querySelectorAll('.flow-line').forEach(line => {
        const from = line.dataset.from;
        const to = line.dataset.to;
        if (from === name || to === name) {
          line.classList.add('highlighted');
          line.classList.remove('dimmed');
        } else {
          line.classList.add('dimmed');
          line.classList.remove('highlighted');
        }
      });

      document.querySelectorAll('.loop-card').forEach(card => {
        card.classList.remove('selected');
        if (card.dataset.module === name) {
          card.classList.add('selected');
        }
      });

      const info = LOOP_INFO[name] || { name, description: 'Component of BYRD Omega system.' };

      document.getElementById('detail-name').textContent = info.name || name;
      document.getElementById('detail-desc').textContent = info.description;

      let statsHtml = '';
      if (info.file) {
        statsHtml += `<div class="mb-1"><span class="text-cyan-400">File:</span> ${info.file}</div>`;
      }
      if (info.files) {
        statsHtml += `<div class="mb-1"><span class="text-cyan-400">Files:</span> ${info.files.join(', ')}</div>`;
      }
      if (info.replaces) {
        statsHtml += `<div class="mb-1"><span class="text-rose-400">Replaces:</span> ${info.replaces.join(', ')}</div>`;
      }
      if (info.mechanism) {
        statsHtml += `<div class="mb-2"><span class="text-violet-400">Mechanism:</span> ${info.mechanism}</div>`;
      }
      if (info.successMetric) {
        statsHtml += `<span class="text-green-400">Success:</span> ${info.successMetric}`;
      }
      if (info.plateauWarning && info.plateauWarning !== 'N/A') {
        statsHtml += ` &nbsp;|&nbsp; <span class="text-yellow-400">Warning:</span> ${info.plateauWarning}`;
      }
      if (info.deprecated) {
        statsHtml += `<div class="mt-2 text-rose-500 font-semibold">DEPRECATED - Use replacement component</div>`;
      }
      if (info.protected) {
        statsHtml += `<div class="mt-2 text-rose-500 font-semibold">PROTECTED - Cannot be modified</div>`;
      }
      document.getElementById('detail-stats').innerHTML = statsHtml;

      let metricHtml = '';
      if (['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind'].includes(name)) {
        const value = Math.random() * 70 + 30;
        metricHtml = `
          <div class="text-xs text-slate-400 mb-1">Loop Health</div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${value}%; background: ${info.color}"></div>
          </div>
        `;
      }
      document.getElementById('detail-metric').innerHTML = metricHtml;

      document.getElementById('selected-detail').classList.remove('hidden');
    }

    function deselectModule() {
      selectedModule = null;

      document.querySelectorAll('.component-box').forEach(box => {
        box.classList.remove('selected');
      });

      document.querySelectorAll('.flow-line').forEach(line => {
        line.classList.remove('highlighted', 'dimmed');
      });

      document.querySelectorAll('.loop-card').forEach(card => {
        card.classList.remove('selected');
      });

      document.getElementById('selected-detail').classList.add('hidden');
    }

    function toggleAnimation() {
      animationPaused = !animationPaused;
      document.querySelectorAll('.flow-line').forEach(line => {
        line.classList.toggle('paused', animationPaused);
      });
      document.getElementById('anim-toggle').textContent = animationPaused ? 'Resume Flow' : 'Pause Flow';
    }

    // ========================================================================
    // DATA FETCHING
    // ========================================================================
    async function fetchStatus() {
      try {
        const response = await fetch(`${API_BASE}/api/status`);
        if (!response.ok) throw new Error('Failed to fetch status');
        return await response.json();
      } catch (e) {
        console.error('Status fetch error:', e);
        return null;
      }
    }

    async function fetchOmegaMetrics() {
      try {
        const response = await fetch(`${API_BASE}/api/omega/metrics`);
        if (!response.ok) throw new Error('Failed to fetch omega metrics');
        return await response.json();
      } catch (e) {
        console.error('Omega metrics fetch error:', e);
        return null;
      }
    }

    function updateModeIndicator(mode) {
      const modeEl = document.getElementById('current-mode');
      const modeColors = {
        'AWAKE': { bg: 'bg-violet-400', border: 'border-violet-500/30', text: 'text-violet-300' },
        'DREAMING': { bg: 'bg-amber-400', border: 'border-amber-500/30', text: 'text-amber-300' },
        'EVOLVING': { bg: 'bg-green-400', border: 'border-green-500/30', text: 'text-green-300' },
        'COMPILING': { bg: 'bg-rose-400', border: 'border-rose-500/30', text: 'text-rose-300' },
        'disabled': { bg: 'bg-slate-400', border: 'border-slate-500/30', text: 'text-slate-300' },
        'error': { bg: 'bg-red-400', border: 'border-red-500/30', text: 'text-red-300' }
      };

      const colors = modeColors[mode?.toUpperCase()] || modeColors['disabled'];
      const displayMode = mode?.toUpperCase() || 'DISABLED';

      modeEl.innerHTML = `
        <span class="w-2 h-2 rounded-full ${colors.bg} animate-pulse"></span>
        <span class="${colors.text} text-sm font-medium">${displayMode}</span>
      `;
      modeEl.className = `flex items-center gap-2 px-3 py-1.5 rounded-lg bg-opacity-20 ${colors.border}`;

      ['awake', 'dreaming', 'evolving', 'compiling'].forEach(m => {
        const modeRect = document.getElementById(`mode-${m}`);
        if (modeRect) {
          modeRect.classList.toggle('active', m === mode?.toLowerCase());
        }
      });
    }

    function renderUI(statusData, omegaData) {
      // Core Components list
      const coreList = document.getElementById('core-list');
      const coreComponents = ['Dreamer', 'Seeker', 'OpenCodeCoder', 'Voice', 'RequestEvaluator'];

      coreList.innerHTML = coreComponents.map(name => {
        const info = LOOP_INFO[name];
        return `
          <div class="loop-card py-2" data-module="${name}" onclick="selectModule('${name}')">
            <div class="flex items-center justify-between">
              <span class="font-medium text-xs" style="color: ${info.color}">${info.name}</span>
              <span class="w-2 h-2 rounded-full bg-green-500"></span>
            </div>
          </div>
        `;
      }).join('');

      // v2.1 Features list
      const v21List = document.getElementById('v21-list');
      const v21Components = ['GoalCascade', 'ContextLoader', 'PluginManager', 'DualInstanceManager'];

      v21List.innerHTML = v21Components.map(name => {
        const info = LOOP_INFO[name];
        return `
          <div class="loop-card py-2" data-module="${name}" onclick="selectModule('${name}')">
            <div class="flex items-center justify-between">
              <span class="font-medium text-xs" style="color: ${info.color}">${info.name}</span>
              <span class="w-2 h-2 rounded-full bg-violet-500"></span>
            </div>
          </div>
        `;
      }).join('');

      // AGI Execution Engine list
      const agiList = document.getElementById('agi-list');
      const agiComponents = ['AGIRunner', 'DesireClassifier', 'LearningSubstrate', 'CapabilityEvaluator', 'ComputeIntrospector'];

      agiList.innerHTML = agiComponents.map(name => {
        const info = LOOP_INFO[name];
        return `
          <div class="loop-card py-2" data-module="${name}" onclick="selectModule('${name}')">
            <div class="flex items-center justify-between">
              <span class="font-medium text-xs" style="color: ${info.color}">${info.name}</span>
              <span class="w-2 h-2 rounded-full bg-green-500"></span>
            </div>
          </div>
        `;
      }).join('');

      // Option B Loops list
      const loopsList = document.getElementById('loops-list');
      const loops = ['MemoryReasoner', 'SelfCompiler', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind'];

      loopsList.innerHTML = loops.map(name => {
        const info = LOOP_INFO[name];
        const loopData = omegaData?.loops?.[name] || {};
        const isHealthy = loopData.is_healthy !== false;

        return `
          <div class="loop-card py-2" data-module="${name}" onclick="selectModule('${name}')">
            <div class="flex items-center justify-between">
              <span class="font-medium text-xs" style="color: ${info.color}">${info.name}</span>
              <span class="w-2 h-2 rounded-full ${isHealthy ? 'bg-green-500' : 'bg-red-500'}"></span>
            </div>
            <div class="text-xs text-slate-600">${info.successMetric}</div>
          </div>
        `;
      }).join('');

      // Metrics panel
      const metricsPanel = document.getElementById('metrics-panel');
      const improvementRate = omegaData?.growth_rate ?? 0;
      const capabilityScore = omegaData?.capability_score ?? 0;
      const criticalCoupling = omegaData?.critical_coupling ?? 0;
      const totalCycles = omegaData?.total_cycles ?? 0;

      const improvementPct = (improvementRate * 100).toFixed(1);
      const capabilityPct = (capabilityScore * 100).toFixed(0);
      const couplingPct = (criticalCoupling * 100).toFixed(0);

      metricsPanel.innerHTML = `
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Improvement Rate</span>
            <span class="text-violet-400">${improvementPct > 0 ? '+' : ''}${improvementPct}%</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${Math.min(100, Math.abs(improvementRate) * 100)}%; background: #a78bfa"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Capability Score</span>
            <span class="text-green-400">${capabilityPct}%</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${capabilityPct}%; background: #22c55e"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Goal->Compiler Coupling</span>
            <span class="text-amber-400">r=${(criticalCoupling).toFixed(2)}</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${couplingPct}%; background: #fbbf24"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Total Omega Cycles</span>
            <span class="text-cyan-400">${totalCycles}</span>
          </div>
          <div class="text-xs text-slate-600">${omegaData?.enabled ? 'Active' : 'Disabled'} ${omegaData?.improvement_trajectory ? `(${omegaData.improvement_trajectory})` : ''}</div>
        </div>
      `;

      if (omegaData) {
        updateModeIndicator(omegaData.mode);
      }

      loops.forEach(name => {
        const loopData = omegaData?.loops?.[name] || {};
        const isHealthy = loopData.is_healthy !== false;
        const statusDot = document.querySelector(`[data-status="${name}"]`);
        if (statusDot) {
          statusDot.setAttribute('fill', isHealthy ? '#22c55e' : '#ef4444');
        }
      });

      const omegaDot = document.querySelector('[data-status="Omega"]');
      if (omegaDot) {
        omegaDot.setAttribute('fill', omegaData?.enabled ? '#22c55e' : '#64748b');
      }

      const statusEl = document.getElementById('system-status');
      const running = statusData?.running;
      statusEl.innerHTML = `
        <span class="w-2 h-2 rounded-full ${running ? 'bg-green-500' : 'bg-yellow-500'} animate-pulse"></span>
        <span class="text-slate-400">${running ? `Running (${statusData?.dream_count || 0} dreams)` : 'Stopped'}</span>
      `;

      const killCriteria = document.getElementById('kill-criteria');
      const trajectory = omegaData?.improvement_trajectory || 'unknown';
      const trajectoryStatus = trajectory === 'improving' ? 'text-green-400' :
                               trajectory === 'plateau' ? 'text-yellow-400' :
                               trajectory === 'declining' ? 'text-red-400' : 'text-slate-400';

      killCriteria.innerHTML = `
        <div class="flex justify-between items-center">
          <span class="text-slate-400">Zero growth</span>
          <span class="${trajectoryStatus}">${trajectory === 'declining' ? 'WARNING' : 'OK'} (4 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">LLM efficiency</span>
          <span class="${capabilityScore > 0.3 ? 'text-green-400' : 'text-yellow-400'}">${capabilityScore > 0.3 ? 'OK' : 'WARN'} (6 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">All loops failing</span>
          <span class="text-green-400">OK (4 week limit)</span>
        </div>
      `;
    }

    async function refresh() {
      const [statusData, omegaData] = await Promise.all([
        fetchStatus(),
        fetchOmegaMetrics()
      ]);
      architectureData = statusData;
      renderUI(statusData, omegaData);
    }

    // ========================================================================
    // INITIALIZATION
    // ========================================================================
    document.addEventListener('DOMContentLoaded', async () => {
      await refresh();
      setInterval(refresh, 10000);

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          deselectModule();
        }
      });
    });
  </script>
</body>
</html>

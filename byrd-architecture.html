<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BYRD Omega Architecture</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
      font-family: 'Inter', system-ui, sans-serif;
    }

    .glass-panel {
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
    }

    .sacred-title {
      background: linear-gradient(90deg, #a78bfa, #818cf8, #6366f1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Component styling */
    .component-box {
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .component-box:hover .box-bg {
      filter: brightness(1.2);
    }

    .component-box:hover .box-outline {
      stroke-width: 2.5;
      filter: drop-shadow(0 0 8px currentColor);
    }

    .component-box.selected .box-outline {
      stroke-width: 3;
      filter: drop-shadow(0 0 12px currentColor);
    }

    /* Flow line animations */
    .flow-line {
      stroke-dasharray: 8 4;
      animation: flowDash 1s linear infinite;
    }

    .flow-line.paused {
      animation-play-state: paused;
    }

    @keyframes flowDash {
      to { stroke-dashoffset: -12; }
    }

    .flow-line.dimmed {
      opacity: 0.15;
    }

    .flow-line.highlighted {
      opacity: 1;
      stroke-width: 3;
    }

    .flow-label {
      font-size: 10px;
      fill: #94a3b8;
      pointer-events: none;
    }

    .flow-label.highlighted {
      fill: #e2e8f0;
      font-weight: 600;
    }

    /* Status indicators */
    .status-dot {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Loop cards */
    .loop-card {
      background: rgba(30, 27, 75, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 8px;
      padding: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .loop-card:hover {
      border-color: rgba(139, 92, 246, 0.5);
      background: rgba(30, 27, 75, 0.8);
    }

    .loop-card.selected {
      border-color: rgba(139, 92, 246, 0.8);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
    }

    /* Mode indicator */
    .mode-indicator {
      transition: all 0.3s ease;
    }

    .mode-indicator.active {
      transform: scale(1.1);
      box-shadow: 0 0 15px currentColor;
    }

    /* Metric bar */
    .metric-bar {
      height: 6px;
      border-radius: 3px;
      background: rgba(100, 116, 139, 0.3);
      overflow: hidden;
    }

    .metric-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 3px;
    }

    /* Legend items */
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #94a3b8;
    }

    .legend-line {
      width: 24px;
      height: 2px;
    }

    /* Coupling indicator */
    .coupling-line {
      stroke-dasharray: 4 2;
      opacity: 0.4;
    }

    .coupling-line.multiplicative {
      stroke-width: 3;
      opacity: 0.8;
      filter: drop-shadow(0 0 4px currentColor);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="fixed top-0 left-0 right-0 p-4 z-50">
    <div class="glass-panel px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="byrd-3d-visualization.html" class="text-violet-400 hover:text-violet-300 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
        </a>
        <div>
          <h1 class="text-2xl font-bold sacred-title">BYRD Omega Architecture</h1>
          <p class="text-xs text-slate-500 mt-0.5">Five Compounding Loops + Unified Memory</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <!-- Current Mode -->
        <div id="current-mode" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-violet-500/20 border border-violet-500/30">
          <span class="w-2 h-2 rounded-full bg-violet-400 animate-pulse"></span>
          <span class="text-violet-300 text-sm font-medium">AWAKE</span>
        </div>
        <div id="system-status" class="flex items-center gap-2 text-sm">
          <span class="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></span>
          <span class="text-slate-400">Loading...</span>
        </div>
        <button onclick="toggleAnimation()" id="anim-toggle" class="px-3 py-1.5 bg-violet-500/20 border border-violet-500/50 rounded-lg text-violet-300 hover:bg-violet-500/30 text-sm transition-colors">
          Pause Flow
        </button>
      </div>
    </div>
  </div>

  <!-- Main Flowchart -->
  <div class="fixed top-24 left-4 right-80 bottom-20 flex items-center justify-center">
    <svg id="flowchart" viewBox="0 0 1000 580" class="w-full h-full max-w-5xl">
      <defs>
        <!-- Arrowhead markers -->
        <marker id="arrow-violet" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#a78bfa"/>
        </marker>
        <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
        </marker>
        <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
        </marker>
        <marker id="arrow-amber" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/>
        </marker>
        <marker id="arrow-teal" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#14b8a6"/>
        </marker>
        <marker id="arrow-rose" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#f43f5e"/>
        </marker>
        <marker id="arrow-cyan" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#06b6d4"/>
        </marker>
        <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#f97316"/>
        </marker>

        <!-- Gradients for component boxes -->
        <linearGradient id="grad-memory" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-kernel" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#4c1d95;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e1b4b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-compiler" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#881337;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-reasoner" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#164e63;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-evolver" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#14532d;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-dreaming" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#78350f;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-integration" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#134e4a;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="grad-omega" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#7f1d1d;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#1e293b;stop-opacity:1" />
        </linearGradient>
      </defs>

      <!-- Philosophy Quote -->
      <text x="500" y="30" text-anchor="middle" fill="#64748b" font-size="12" font-style="italic">
        "Make each LLM call 10x more valuable through smart scaffolding."
      </text>

      <!-- Flow Lines (drawn first, behind components) -->
      <g id="flow-lines">
        <!-- Memory to all loops -->
        <path class="flow-line" d="M500,140 L200,220" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="SelfCompiler"/>
        <path class="flow-line" d="M500,140 L350,220" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="MemoryReasoner"/>
        <path class="flow-line" d="M500,140 L500,220" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="GoalEvolver"/>
        <path class="flow-line" d="M500,140 L650,220" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="DreamingMachine"/>
        <path class="flow-line" d="M500,140 L800,220" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-blue)" data-from="Memory" data-to="IntegrationMind"/>

        <!-- Loops to Memory (feedback) -->
        <path class="flow-line" d="M200,220 L425,115" stroke="#f43f5e" stroke-width="2" fill="none" marker-end="url(#arrow-rose)" data-from="SelfCompiler" data-to="Memory"/>
        <path class="flow-line" d="M350,220 L450,115" stroke="#06b6d4" stroke-width="2" fill="none" marker-end="url(#arrow-cyan)" data-from="MemoryReasoner" data-to="Memory"/>
        <path class="flow-line" d="M500,220 L500,140" stroke="#22c55e" stroke-width="2" fill="none" marker-end="url(#arrow-green)" data-from="GoalEvolver" data-to="Memory"/>
        <path class="flow-line" d="M650,220 L550,115" stroke="#fbbf24" stroke-width="2" fill="none" marker-end="url(#arrow-amber)" data-from="DreamingMachine" data-to="Memory"/>
        <path class="flow-line" d="M800,220 L575,115" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrow-teal)" data-from="IntegrationMind" data-to="Memory"/>

        <!-- Loops to Omega -->
        <path class="flow-line" d="M200,310 L410,450" stroke="#f43f5e" stroke-width="1.5" fill="none" marker-end="url(#arrow-rose)" data-from="SelfCompiler" data-to="Omega"/>
        <path class="flow-line" d="M350,310 L440,450" stroke="#06b6d4" stroke-width="1.5" fill="none" marker-end="url(#arrow-cyan)" data-from="MemoryReasoner" data-to="Omega"/>
        <path class="flow-line" d="M500,310 L500,450" stroke="#22c55e" stroke-width="1.5" fill="none" marker-end="url(#arrow-green)" data-from="GoalEvolver" data-to="Omega"/>
        <path class="flow-line" d="M650,310 L560,450" stroke="#fbbf24" stroke-width="1.5" fill="none" marker-end="url(#arrow-amber)" data-from="DreamingMachine" data-to="Omega"/>
        <path class="flow-line" d="M800,310 L590,450" stroke="#14b8a6" stroke-width="1.5" fill="none" marker-end="url(#arrow-teal)" data-from="IntegrationMind" data-to="Omega"/>

        <!-- Critical Coupling: Goal → Compiler (MULTIPLICATIVE) -->
        <path class="coupling-line multiplicative" d="M455,265 C350,340 250,340 200,290" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#arrow-green)" data-from="GoalEvolver" data-to="SelfCompiler"/>
        <text x="320" y="345" text-anchor="middle" fill="#22c55e" font-size="9" font-weight="600">MULTIPLICATIVE</text>

        <!-- Other couplings (additive) -->
        <path class="coupling-line" d="M350,270 L650,270" stroke="#64748b" stroke-width="1" fill="none" data-from="MemoryReasoner" data-to="DreamingMachine"/>
        <text x="500" y="285" text-anchor="middle" fill="#64748b" font-size="8">additive</text>

        <!-- Kernel to Memory -->
        <path class="flow-line" d="M880,100 L575,100" stroke="#a78bfa" stroke-width="2" fill="none" marker-end="url(#arrow-violet)" data-from="Kernel" data-to="Memory"/>
        <text class="flow-label" x="720" y="93">identity</text>
      </g>

      <!-- Component Boxes -->
      <g id="components">
        <!-- UNIFIED MEMORY (top center) -->
        <g class="component-box" data-module="Memory" onclick="selectModule('Memory')">
          <rect class="box-bg" x="400" y="60" width="200" height="80" rx="12" fill="url(#grad-memory)"/>
          <rect class="box-outline" x="400" y="60" width="200" height="80" rx="12" fill="none" stroke="#3b82f6" stroke-width="2"/>
          <text x="500" y="95" text-anchor="middle" fill="#3b82f6" font-weight="700" font-size="14">UNIFIED MEMORY</text>
          <text x="500" y="115" text-anchor="middle" fill="#64748b" font-size="11">(Neo4j Graph)</text>
          <text x="500" y="130" text-anchor="middle" fill="#475569" font-size="9">Experiences · Patterns · Goals · Beliefs</text>
          <circle class="status-dot" cx="585" cy="72" r="5" fill="#22c55e" data-status="Memory"/>
        </g>

        <!-- THE KERNEL (top right) -->
        <g class="component-box" data-module="Kernel" onclick="selectModule('Kernel')">
          <rect class="box-bg" x="880" y="60" width="100" height="80" rx="8" fill="url(#grad-kernel)"/>
          <rect class="box-outline" x="880" y="60" width="100" height="80" rx="8" fill="none" stroke="#a78bfa" stroke-width="1.5"/>
          <text x="930" y="90" text-anchor="middle" fill="#a78bfa" font-weight="600" font-size="12">KERNEL</text>
          <text x="930" y="105" text-anchor="middle" fill="#64748b" font-size="9">voice</text>
          <text x="930" y="117" text-anchor="middle" fill="#64748b" font-size="9">identity</text>
          <text x="930" y="129" text-anchor="middle" fill="#64748b" font-size="9">values</text>
          <circle class="status-dot" cx="965" cy="72" r="4" fill="#a78bfa" data-status="Kernel"/>
        </g>

        <!-- LOOP 1: SELF-COMPILER -->
        <g class="component-box" data-module="SelfCompiler" onclick="selectModule('SelfCompiler')">
          <rect class="box-bg" x="100" y="220" width="160" height="90" rx="10" fill="url(#grad-compiler)"/>
          <rect class="box-outline" x="100" y="220" width="160" height="90" rx="10" fill="none" stroke="#f43f5e" stroke-width="1.5"/>
          <text x="180" y="248" text-anchor="middle" fill="#f43f5e" font-weight="600" font-size="13">SELF-COMPILER</text>
          <text x="180" y="268" text-anchor="middle" fill="#64748b" font-size="10">Pattern Library</text>
          <text x="180" y="285" text-anchor="middle" fill="#475569" font-size="9">patterns → future mods</text>
          <text x="180" y="300" text-anchor="middle" fill="#475569" font-size="9">more likely to succeed</text>
          <circle class="status-dot" cx="245" cy="232" r="4" fill="#22c55e" data-status="SelfCompiler"/>
        </g>

        <!-- LOOP 2: MEMORY REASONER -->
        <g class="component-box" data-module="MemoryReasoner" onclick="selectModule('MemoryReasoner')">
          <rect class="box-bg" x="280" y="220" width="160" height="90" rx="10" fill="url(#grad-reasoner)"/>
          <rect class="box-outline" x="280" y="220" width="160" height="90" rx="10" fill="none" stroke="#06b6d4" stroke-width="1.5"/>
          <text x="360" y="248" text-anchor="middle" fill="#06b6d4" font-weight="600" font-size="13">MEMORY REASONER</text>
          <text x="360" y="268" text-anchor="middle" fill="#64748b" font-size="10">Spreading Activation</text>
          <text x="360" y="285" text-anchor="middle" fill="#475569" font-size="9">graph answers queries</text>
          <text x="360" y="300" text-anchor="middle" fill="#475569" font-size="9">before LLM calls</text>
          <circle class="status-dot" cx="425" cy="232" r="4" fill="#22c55e" data-status="MemoryReasoner"/>
        </g>

        <!-- LOOP 3: GOAL EVOLVER -->
        <g class="component-box" data-module="GoalEvolver" onclick="selectModule('GoalEvolver')">
          <rect class="box-bg" x="460" y="220" width="160" height="90" rx="10" fill="url(#grad-evolver)"/>
          <rect class="box-outline" x="460" y="220" width="160" height="90" rx="10" fill="none" stroke="#22c55e" stroke-width="1.5"/>
          <text x="540" y="248" text-anchor="middle" fill="#22c55e" font-weight="600" font-size="13">GOAL EVOLVER</text>
          <text x="540" y="268" text-anchor="middle" fill="#64748b" font-size="10">Evolutionary Selection</text>
          <text x="540" y="285" text-anchor="middle" fill="#475569" font-size="9">goals evolve via fitness</text>
          <text x="540" y="300" text-anchor="middle" fill="#475569" font-size="9">better goals survive</text>
          <circle class="status-dot" cx="605" cy="232" r="4" fill="#22c55e" data-status="GoalEvolver"/>
        </g>

        <!-- LOOP 4: DREAMING MACHINE -->
        <g class="component-box" data-module="DreamingMachine" onclick="selectModule('DreamingMachine')">
          <rect class="box-bg" x="640" y="220" width="160" height="90" rx="10" fill="url(#grad-dreaming)"/>
          <rect class="box-outline" x="640" y="220" width="160" height="90" rx="10" fill="none" stroke="#fbbf24" stroke-width="1.5"/>
          <text x="720" y="248" text-anchor="middle" fill="#fbbf24" font-weight="600" font-size="13">DREAMING MACHINE</text>
          <text x="720" y="268" text-anchor="middle" fill="#64748b" font-size="10">Counterfactuals</text>
          <text x="720" y="285" text-anchor="middle" fill="#475569" font-size="9">1 exp → N variations</text>
          <text x="720" y="300" text-anchor="middle" fill="#475569" font-size="9">multiply learning</text>
          <circle class="status-dot" cx="785" cy="232" r="4" fill="#22c55e" data-status="DreamingMachine"/>
        </g>

        <!-- LOOP 5: INTEGRATION MIND -->
        <g class="component-box" data-module="IntegrationMind" onclick="selectModule('IntegrationMind')">
          <rect class="box-bg" x="820" y="220" width="160" height="90" rx="10" fill="url(#grad-integration)"/>
          <rect class="box-outline" x="820" y="220" width="160" height="90" rx="10" fill="none" stroke="#14b8a6" stroke-width="1.5"/>
          <text x="900" y="248" text-anchor="middle" fill="#14b8a6" font-weight="600" font-size="13">INTEGRATION MIND</text>
          <text x="900" y="268" text-anchor="middle" fill="#64748b" font-size="10">Cross-Loop Synergy</text>
          <text x="900" y="285" text-anchor="middle" fill="#475569" font-size="9">emergent behaviors</text>
          <text x="900" y="300" text-anchor="middle" fill="#475569" font-size="9">combined value > sum</text>
          <circle class="status-dot" cx="965" cy="232" r="4" fill="#22c55e" data-status="IntegrationMind"/>
        </g>

        <!-- BYRD OMEGA (bottom center) -->
        <g class="component-box" data-module="Omega" onclick="selectModule('Omega')">
          <rect class="box-bg" x="380" y="450" width="240" height="100" rx="12" fill="url(#grad-omega)"/>
          <rect class="box-outline" x="380" y="450" width="240" height="100" rx="12" fill="none" stroke="#ef4444" stroke-width="2"/>
          <text x="500" y="485" text-anchor="middle" fill="#ef4444" font-weight="700" font-size="16">BYRD OMEGA</text>
          <text x="500" y="505" text-anchor="middle" fill="#64748b" font-size="11">(Orchestrator)</text>
          <text x="500" y="525" text-anchor="middle" fill="#475569" font-size="9">Mode Controller · Safety Monitor</text>
          <text x="500" y="540" text-anchor="middle" fill="#475569" font-size="9">Coupling Tracker · Metrics</text>
          <circle class="status-dot" cx="605" cy="462" r="5" fill="#22c55e" data-status="Omega"/>
        </g>

        <!-- Mode Transition Diagram (left side) -->
        <g transform="translate(20, 380)">
          <text x="60" y="0" text-anchor="middle" fill="#64748b" font-size="10" font-weight="600">MODE TRANSITIONS</text>

          <!-- AWAKE -->
          <rect id="mode-awake" x="20" y="15" width="80" height="30" rx="6" fill="rgba(139, 92, 246, 0.2)" stroke="#a78bfa" stroke-width="1.5" class="mode-indicator active"/>
          <text x="60" y="35" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600">AWAKE</text>

          <!-- Arrow down -->
          <path d="M60,48 L60,58" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>

          <!-- DREAMING -->
          <rect id="mode-dreaming" x="20" y="60" width="80" height="30" rx="6" fill="rgba(251, 191, 36, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="80" text-anchor="middle" fill="#64748b" font-size="10">DREAMING</text>

          <!-- Arrow down -->
          <path d="M60,93 L60,103" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>

          <!-- EVOLVING -->
          <rect id="mode-evolving" x="20" y="105" width="80" height="30" rx="6" fill="rgba(34, 197, 94, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="125" text-anchor="middle" fill="#64748b" font-size="10">EVOLVING</text>

          <!-- Arrow down -->
          <path d="M60,138 L60,148" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-violet)"/>

          <!-- COMPILING -->
          <rect id="mode-compiling" x="20" y="150" width="80" height="30" rx="6" fill="rgba(244, 63, 94, 0.1)" stroke="#64748b" stroke-width="1" class="mode-indicator"/>
          <text x="60" y="170" text-anchor="middle" fill="#64748b" font-size="10">COMPILING</text>

          <!-- Return arrow -->
          <path d="M105,165 C140,140 140,50 105,25" stroke="#64748b" stroke-width="1" fill="none" stroke-dasharray="3 2"/>
        </g>
      </g>
    </svg>
  </div>

  <!-- Side Panel -->
  <div class="fixed top-24 right-4 bottom-4 w-72 overflow-hidden flex flex-col gap-4">
    <!-- Loops Panel -->
    <div class="glass-panel p-4 flex-1 overflow-y-auto">
      <h2 class="text-lg font-semibold text-white mb-3">Five Compounding Loops</h2>
      <div id="loops-list" class="space-y-2">
        <!-- Populated by JS -->
      </div>

      <!-- Acceleration Metrics -->
      <h3 class="text-sm font-semibold text-slate-400 mt-5 mb-3">Acceleration Metrics</h3>
      <div id="metrics-panel" class="space-y-3">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Kill Criteria Panel -->
    <div class="glass-panel p-4">
      <h3 class="text-sm font-semibold text-white mb-2">Kill Criteria Status</h3>
      <div id="kill-criteria" class="space-y-2 text-xs">
        <div class="flex justify-between items-center">
          <span class="text-slate-400">Zero growth</span>
          <span class="text-green-400">OK (4 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">LLM efficiency</span>
          <span class="text-green-400">OK (6 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">All loops failing</span>
          <span class="text-green-400">OK (4 week limit)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Selected Module Detail -->
  <div id="selected-detail" class="fixed bottom-20 left-4 right-80 hidden">
    <div class="glass-panel p-4">
      <div class="flex items-start justify-between">
        <div>
          <h3 id="detail-name" class="text-lg font-semibold text-white"></h3>
          <p id="detail-desc" class="text-sm text-slate-400 mt-1"></p>
        </div>
        <button onclick="deselectModule()" class="text-slate-400 hover:text-white">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div id="detail-stats" class="mt-3 text-xs text-slate-500"></div>
      <div id="detail-metric" class="mt-2"></div>
    </div>
  </div>

  <!-- Legend -->
  <div class="fixed bottom-4 left-4 right-80">
    <div class="glass-panel px-4 py-3">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <div class="flex gap-4 flex-wrap">
          <div class="legend-item">
            <div class="legend-line" style="background: #3b82f6;"></div>
            <span>Context Flow</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #22c55e;"></div>
            <span>Goal→Compiler (Multiplicative)</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #64748b;"></div>
            <span>Additive Coupling</span>
          </div>
          <div class="legend-item">
            <div class="legend-line" style="background: #a78bfa;"></div>
            <span>Identity</span>
          </div>
        </div>
        <div class="text-xs text-slate-500">
          Based on SEEDARCHITECTURE.md
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========================================================================
    // CONFIGURATION
    // ========================================================================
    const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    const API_BASE = isLocalhost ? 'http://localhost:8000' : window.location.origin;

    let architectureData = null;
    let selectedModule = null;
    let animationPaused = false;

    // Loop information based on SEEDARCHITECTURE.md
    const LOOP_INFO = {
      SelfCompiler: {
        name: 'Self-Compiler',
        description: 'Extracts reusable patterns from successful modifications, making future modifications more likely to succeed.',
        color: '#f43f5e',
        mechanism: 'Pattern library grows → future problems have more relevant patterns → higher success rate → more patterns extracted',
        successMetric: 'Modification success rate > 50%',
        plateauWarning: 'Flat at < 40%'
      },
      MemoryReasoner: {
        name: 'Memory Reasoner',
        description: 'Answers queries from the graph before calling the LLM, making each LLM call more valuable.',
        color: '#06b6d4',
        mechanism: 'More experiences → richer graph → more queries answered from memory → LLM calls reserved for novel problems',
        successMetric: 'Memory reasoning ratio > 50%',
        plateauWarning: 'Flat at < 30%'
      },
      GoalEvolver: {
        name: 'Goal Evolver',
        description: 'Goals evolve through fitness selection, producing increasingly effective goals.',
        color: '#22c55e',
        mechanism: 'Fitness-weighted selection → better goals survive → system pursues more valuable objectives',
        successMetric: 'Average fitness increasing per generation',
        plateauWarning: 'Fitness flat for 5+ generations'
      },
      DreamingMachine: {
        name: 'Dreaming Machine',
        description: 'Generates counterfactual experiences and hypotheses, multiplying learning from each real experience.',
        color: '#fbbf24',
        mechanism: 'One experience → N imagined variations → N+1 learning opportunities',
        successMetric: 'Insight extraction rate > 15%',
        plateauWarning: 'Rate < 10%'
      },
      IntegrationMind: {
        name: 'Integration Mind',
        description: 'Enables cross-loop synergies that produce emergent behaviors.',
        color: '#14b8a6',
        mechanism: 'If loops reinforce each other, combined value > sum of parts',
        successMetric: 'Emergent behaviors > 0',
        plateauWarning: 'None observed after week 4'
      },
      Memory: {
        name: 'Unified Memory',
        description: 'Neo4j graph database. Single source of truth for all experiences, patterns, goals, beliefs, and capabilities.',
        color: '#3b82f6',
        mechanism: 'All state, all learning, all provenance stored in graph',
        successMetric: 'Graph connectivity',
        plateauWarning: 'N/A'
      },
      Kernel: {
        name: 'The Kernel',
        description: 'BYRD\'s operating nucleus—a single Neo4j node read at the START of every dream cycle containing voice, identity, values, and constraints.',
        color: '#a78bfa',
        mechanism: 'Loaded at start of each dream cycle to ground reflection in core identity',
        successMetric: 'Identity coherence',
        plateauWarning: 'N/A'
      },
      Omega: {
        name: 'BYRD Omega',
        description: 'The orchestrator that manages mode transitions, safety monitoring, coupling tracking, and metrics collection.',
        color: '#ef4444',
        mechanism: 'Coordinates all loops, manages state transitions, ensures safety',
        successMetric: 'System health',
        plateauWarning: 'N/A'
      }
    };

    // Flow connections for highlighting
    const FLOW_CONNECTIONS = {
      Memory: ['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind', 'Kernel'],
      Kernel: ['Memory'],
      SelfCompiler: ['Memory', 'Omega', 'GoalEvolver'],
      MemoryReasoner: ['Memory', 'Omega', 'DreamingMachine'],
      GoalEvolver: ['Memory', 'Omega', 'SelfCompiler'],
      DreamingMachine: ['Memory', 'Omega', 'MemoryReasoner'],
      IntegrationMind: ['Memory', 'Omega'],
      Omega: ['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind']
    };

    // ========================================================================
    // SELECTION & HIGHLIGHTING
    // ========================================================================
    function selectModule(name) {
      selectedModule = name;

      // Highlight component boxes
      document.querySelectorAll('.component-box').forEach(box => {
        box.classList.remove('selected');
        if (box.dataset.module === name) {
          box.classList.add('selected');
        }
      });

      // Highlight connected flows
      const connected = FLOW_CONNECTIONS[name] || [];
      document.querySelectorAll('.flow-line').forEach(line => {
        const from = line.dataset.from;
        const to = line.dataset.to;
        if (from === name || to === name) {
          line.classList.add('highlighted');
          line.classList.remove('dimmed');
        } else {
          line.classList.add('dimmed');
          line.classList.remove('highlighted');
        }
      });

      // Highlight sidebar card
      document.querySelectorAll('.loop-card').forEach(card => {
        card.classList.remove('selected');
        if (card.dataset.module === name) {
          card.classList.add('selected');
        }
      });

      // Show detail panel
      const info = LOOP_INFO[name] || { name, description: 'Component of BYRD Omega system.' };

      document.getElementById('detail-name').textContent = info.name || name;
      document.getElementById('detail-desc').textContent = info.description;

      let statsHtml = '';
      if (info.mechanism) {
        statsHtml += `<div class="mb-2"><span class="text-violet-400">Mechanism:</span> ${info.mechanism}</div>`;
      }
      if (info.successMetric) {
        statsHtml += `<span class="text-green-400">Success:</span> ${info.successMetric}`;
      }
      if (info.plateauWarning && info.plateauWarning !== 'N/A') {
        statsHtml += ` &nbsp;|&nbsp; <span class="text-yellow-400">Warning:</span> ${info.plateauWarning}`;
      }
      document.getElementById('detail-stats').innerHTML = statsHtml;

      // Show metric bar for loops
      let metricHtml = '';
      if (['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind'].includes(name)) {
        const value = Math.random() * 70 + 30; // Simulated for now
        metricHtml = `
          <div class="text-xs text-slate-400 mb-1">Loop Health</div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${value}%; background: ${info.color}"></div>
          </div>
        `;
      }
      document.getElementById('detail-metric').innerHTML = metricHtml;

      document.getElementById('selected-detail').classList.remove('hidden');
    }

    function deselectModule() {
      selectedModule = null;

      document.querySelectorAll('.component-box').forEach(box => {
        box.classList.remove('selected');
      });

      document.querySelectorAll('.flow-line').forEach(line => {
        line.classList.remove('highlighted', 'dimmed');
      });

      document.querySelectorAll('.loop-card').forEach(card => {
        card.classList.remove('selected');
      });

      document.getElementById('selected-detail').classList.add('hidden');
    }

    function toggleAnimation() {
      animationPaused = !animationPaused;
      document.querySelectorAll('.flow-line').forEach(line => {
        line.classList.toggle('paused', animationPaused);
      });
      document.getElementById('anim-toggle').textContent = animationPaused ? 'Resume Flow' : 'Pause Flow';
    }

    // ========================================================================
    // DATA FETCHING
    // ========================================================================
    async function fetchStatus() {
      try {
        const response = await fetch(`${API_BASE}/api/status`);
        if (!response.ok) throw new Error('Failed to fetch status');
        return await response.json();
      } catch (e) {
        console.error('Status fetch error:', e);
        return null;
      }
    }

    async function fetchOmegaMetrics() {
      try {
        const response = await fetch(`${API_BASE}/api/omega/metrics`);
        if (!response.ok) throw new Error('Failed to fetch omega metrics');
        return await response.json();
      } catch (e) {
        console.error('Omega metrics fetch error:', e);
        return null;
      }
    }

    function updateModeIndicator(mode) {
      const modeEl = document.getElementById('current-mode');
      const modeColors = {
        'AWAKE': { bg: 'bg-violet-400', border: 'border-violet-500/30', text: 'text-violet-300' },
        'DREAMING': { bg: 'bg-amber-400', border: 'border-amber-500/30', text: 'text-amber-300' },
        'EVOLVING': { bg: 'bg-green-400', border: 'border-green-500/30', text: 'text-green-300' },
        'COMPILING': { bg: 'bg-rose-400', border: 'border-rose-500/30', text: 'text-rose-300' },
        'disabled': { bg: 'bg-slate-400', border: 'border-slate-500/30', text: 'text-slate-300' },
        'error': { bg: 'bg-red-400', border: 'border-red-500/30', text: 'text-red-300' }
      };

      const colors = modeColors[mode?.toUpperCase()] || modeColors['disabled'];
      const displayMode = mode?.toUpperCase() || 'DISABLED';

      modeEl.innerHTML = `
        <span class="w-2 h-2 rounded-full ${colors.bg} animate-pulse"></span>
        <span class="${colors.text} text-sm font-medium">${displayMode}</span>
      `;
      modeEl.className = `flex items-center gap-2 px-3 py-1.5 rounded-lg bg-opacity-20 ${colors.border}`;

      // Update mode transition diagram
      ['awake', 'dreaming', 'evolving', 'compiling'].forEach(m => {
        const modeRect = document.getElementById(`mode-${m}`);
        if (modeRect) {
          modeRect.classList.toggle('active', m === mode?.toLowerCase());
        }
      });
    }

    function renderUI(statusData, omegaData) {
      // Loops list
      const loopsList = document.getElementById('loops-list');
      const loops = ['SelfCompiler', 'MemoryReasoner', 'GoalEvolver', 'DreamingMachine', 'IntegrationMind'];

      loopsList.innerHTML = loops.map(name => {
        const info = LOOP_INFO[name];
        // Get loop health from Omega data if available
        const loopData = omegaData?.loops?.[name] || {};
        const isHealthy = loopData.is_healthy !== false; // Default to healthy if no data

        return `
          <div class="loop-card" data-module="${name}" onclick="selectModule('${name}')">
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium text-sm" style="color: ${info.color}">${info.name}</span>
              <span class="w-2 h-2 rounded-full ${isHealthy ? 'bg-green-500' : 'bg-red-500'}"></span>
            </div>
            <div class="text-xs text-slate-500">${info.successMetric}</div>
            ${loopData.cycles_completed ? `<div class="text-xs text-slate-600 mt-1">${loopData.cycles_completed} cycles</div>` : ''}
          </div>
        `;
      }).join('');

      // Metrics panel - use real Omega data if available
      const metricsPanel = document.getElementById('metrics-panel');
      const improvementRate = omegaData?.growth_rate ?? 0;
      const capabilityScore = omegaData?.capability_score ?? 0;
      const criticalCoupling = omegaData?.critical_coupling ?? 0;
      const totalCycles = omegaData?.total_cycles ?? 0;

      // Format improvement rate as percentage
      const improvementPct = (improvementRate * 100).toFixed(1);
      const capabilityPct = (capabilityScore * 100).toFixed(0);
      const couplingPct = (criticalCoupling * 100).toFixed(0);

      metricsPanel.innerHTML = `
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Improvement Rate</span>
            <span class="text-violet-400">${improvementPct > 0 ? '+' : ''}${improvementPct}%</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${Math.min(100, Math.abs(improvementRate) * 100)}%; background: #a78bfa"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Capability Score</span>
            <span class="text-green-400">${capabilityPct}%</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${capabilityPct}%; background: #22c55e"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Goal→Compiler Coupling</span>
            <span class="text-amber-400">r=${(criticalCoupling).toFixed(2)}</span>
          </div>
          <div class="metric-bar">
            <div class="metric-fill" style="width: ${couplingPct}%; background: #fbbf24"></div>
          </div>
        </div>
        <div>
          <div class="flex justify-between text-xs mb-1">
            <span class="text-slate-400">Total Omega Cycles</span>
            <span class="text-cyan-400">${totalCycles}</span>
          </div>
          <div class="text-xs text-slate-600">${omegaData?.enabled ? 'Active' : 'Disabled'} ${omegaData?.improvement_trajectory ? `(${omegaData.improvement_trajectory})` : ''}</div>
        </div>
      `;

      // Update mode indicator
      if (omegaData) {
        updateModeIndicator(omegaData.mode);
      }

      // Update loop health status dots in the SVG
      loops.forEach(name => {
        const loopData = omegaData?.loops?.[name] || {};
        const isHealthy = loopData.is_healthy !== false;
        const statusDot = document.querySelector(`[data-status="${name}"]`);
        if (statusDot) {
          statusDot.setAttribute('fill', isHealthy ? '#22c55e' : '#ef4444');
        }
      });

      // Update Omega status dot
      const omegaDot = document.querySelector('[data-status="Omega"]');
      if (omegaDot) {
        omegaDot.setAttribute('fill', omegaData?.enabled ? '#22c55e' : '#64748b');
      }

      // System status
      const statusEl = document.getElementById('system-status');
      const running = statusData?.running;
      statusEl.innerHTML = `
        <span class="w-2 h-2 rounded-full ${running ? 'bg-green-500' : 'bg-yellow-500'} animate-pulse"></span>
        <span class="text-slate-400">${running ? `Running (${statusData?.dream_count || 0} dreams)` : 'Stopped'}</span>
      `;

      // Update kill criteria based on Omega trajectory
      const killCriteria = document.getElementById('kill-criteria');
      const trajectory = omegaData?.improvement_trajectory || 'unknown';
      const trajectoryStatus = trajectory === 'improving' ? 'text-green-400' :
                               trajectory === 'plateau' ? 'text-yellow-400' :
                               trajectory === 'declining' ? 'text-red-400' : 'text-slate-400';

      killCriteria.innerHTML = `
        <div class="flex justify-between items-center">
          <span class="text-slate-400">Zero growth</span>
          <span class="${trajectoryStatus}">${trajectory === 'declining' ? 'WARNING' : 'OK'} (4 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">LLM efficiency</span>
          <span class="${capabilityScore > 0.3 ? 'text-green-400' : 'text-yellow-400'}">${capabilityScore > 0.3 ? 'OK' : 'WARN'} (6 week limit)</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-slate-400">All loops failing</span>
          <span class="text-green-400">OK (4 week limit)</span>
        </div>
      `;
    }

    async function refresh() {
      const [statusData, omegaData] = await Promise.all([
        fetchStatus(),
        fetchOmegaMetrics()
      ]);
      architectureData = statusData;
      renderUI(statusData, omegaData);
    }

    // ========================================================================
    // INITIALIZATION
    // ========================================================================
    document.addEventListener('DOMContentLoaded', async () => {
      await refresh();

      // Auto-refresh every 10 seconds for live metrics
      setInterval(refresh, 10000);

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          deselectModule();
        }
      });
    });
  </script>
</body>
</html>

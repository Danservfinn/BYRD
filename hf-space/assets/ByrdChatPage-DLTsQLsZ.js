import{E as Je,V as T,M as te,T as ae,S as Se,Q as Re,e as O,f as et,P as tt,h as at,a as g,i as st,C as nt,k as ot,W as rt,l as it,A as lt,D as me,G as ct,I as Ae,m as pe,n as J,o as dt,p as fe,q as ut,s as ht,j as a,c as mt}from"./three-vAZ6Lf4N.js";import{c as W,b as ce,H as pt,d as ft,A as xt,S as gt}from"./index-BCj-z186.js";import{I as bt,C as yt}from"./info-B5AtXINA.js";import"./charts-qd40zQW5.js";const wt=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],jt=W("bot",wt);const kt=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ge=W("camera",kt);const Nt=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Mt=W("chevron-down",Nt);const Et=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Pt=W("chevron-up",Et);const vt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ce=W("refresh-cw",vt);const Tt=[["path",{d:"M16.466 7.5C15.643 4.237 13.952 2 12 2 9.239 2 7 6.477 7 12s2.239 10 5 10c.342 0 .677-.069 1-.2",key:"10n0gc"}],["path",{d:"m15.194 13.707 3.814 1.86-1.86 3.814",key:"16shm9"}],["path",{d:"M19 15.57c-1.804.885-4.274 1.43-7 1.43-5.523 0-10-2.239-10-5s4.477-5 10-5c4.838 0 8.873 1.718 9.8 4",key:"1lxi77"}]],St=W("rotate-3d",Tt);const Rt=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],At=W("send",Rt);const Ct=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Dt=W("user",Ct),De={type:"change"},xe={type:"start"},Oe={type:"end"},le=new et,Ie=new tt,Ot=Math.cos(70*at.DEG2RAD);class It extends Je{constructor(c,w){super(),this.object=c,this.domElement=w,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new T,this.cursor=new T,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:te.ROTATE,MIDDLE:te.DOLLY,RIGHT:te.PAN},this.touches={ONE:ae.ROTATE,TWO:ae.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",ue),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",ue),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(De),e.update(),i=n.NONE},this.update=(function(){const t=new T,s=new Re().setFromUnitVectors(c.up,new T(0,1,0)),u=s.clone().invert(),m=new T,k=new Re,V=new T,A=2*Math.PI;return function(Qe=null){const Te=e.object.position;t.copy(Te).sub(e.target),t.applyQuaternion(s),r.setFromVector3(t),e.autoRotate&&i===n.NONE&&H(q(Qe)),e.enableDamping?(r.theta+=f.theta*e.dampingFactor,r.phi+=f.phi*e.dampingFactor):(r.theta+=f.theta,r.phi+=f.phi);let X=e.minAzimuthAngle,B=e.maxAzimuthAngle;isFinite(X)&&isFinite(B)&&(X<-Math.PI?X+=A:X>Math.PI&&(X-=A),B<-Math.PI?B+=A:B>Math.PI&&(B-=A),X<=B?r.theta=Math.max(X,Math.min(B,r.theta)):r.theta=r.theta>(X+B)/2?Math.max(X,r.theta):Math.min(B,r.theta)),r.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,r.phi)),r.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(C,e.dampingFactor):e.target.add(C),e.target.sub(e.cursor),e.target.clampLength(e.minTargetRadius,e.maxTargetRadius),e.target.add(e.cursor),e.zoomToCursor&&E||e.object.isOrthographicCamera?r.radius=P(r.radius):r.radius=P(r.radius*K),t.setFromSpherical(r),t.applyQuaternion(u),Te.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(f.theta*=1-e.dampingFactor,f.phi*=1-e.dampingFactor,C.multiplyScalar(1-e.dampingFactor)):(f.set(0,0,0),C.set(0,0,0));let he=!1;if(e.zoomToCursor&&E){let ne=null;if(e.object.isPerspectiveCamera){const oe=t.length();ne=P(oe*K);const ie=oe-ne;e.object.position.addScaledVector(S,ie),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const oe=new T(M.x,M.y,0);oe.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/K)),e.object.updateProjectionMatrix(),he=!0;const ie=new T(M.x,M.y,0);ie.unproject(e.object),e.object.position.sub(ie).add(oe),e.object.updateMatrixWorld(),ne=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ne!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ne).add(e.object.position):(le.origin.copy(e.object.position),le.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(le.direction))<Ot?c.lookAt(e.target):(Ie.setFromNormalAndCoplanarPoint(e.object.up,e.target),le.intersectPlane(Ie,e.target))))}else e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/K)),e.object.updateProjectionMatrix(),he=!0);return K=1,E=!1,he||m.distanceToSquared(e.object.position)>b||8*(1-k.dot(e.object.quaternion))>b||V.distanceToSquared(e.target)>0?(e.dispatchEvent(De),m.copy(e.object.position),k.copy(e.object.quaternion),V.copy(e.target),!0):!1}})(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Pe),e.domElement.removeEventListener("pointerdown",Me),e.domElement.removeEventListener("pointercancel",se),e.domElement.removeEventListener("wheel",Ee),e.domElement.removeEventListener("pointermove",de),e.domElement.removeEventListener("pointerup",se),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",ue),e._domElementKeyEvents=null)};const e=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=n.NONE;const b=1e-6,r=new Se,f=new Se;let K=1;const C=new T,I=new O,L=new O,$=new O,F=new O,U=new O,d=new O,p=new O,N=new O,v=new O,S=new T,M=new O;let E=!1;const h=[],_={};function q(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function z(t){const s=Math.abs(t)/(100*(window.devicePixelRatio|0));return Math.pow(.95,e.zoomSpeed*s)}function H(t){f.theta-=t}function D(t){f.phi-=t}const Q=(function(){const t=new T;return function(u,m){t.setFromMatrixColumn(m,0),t.multiplyScalar(-u),C.add(t)}})(),Z=(function(){const t=new T;return function(u,m){e.screenSpacePanning===!0?t.setFromMatrixColumn(m,1):(t.setFromMatrixColumn(m,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(u),C.add(t)}})(),R=(function(){const t=new T;return function(u,m){const k=e.domElement;if(e.object.isPerspectiveCamera){const V=e.object.position;t.copy(V).sub(e.target);let A=t.length();A*=Math.tan(e.object.fov/2*Math.PI/180),Q(2*u*A/k.clientHeight,e.object.matrix),Z(2*m*A/k.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Q(u*(e.object.right-e.object.left)/e.object.zoom/k.clientWidth,e.object.matrix),Z(m*(e.object.top-e.object.bottom)/e.object.zoom/k.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function l(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?K/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function j(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?K*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function y(t,s){if(!e.zoomToCursor)return;E=!0;const u=e.domElement.getBoundingClientRect(),m=t-u.left,k=s-u.top,V=u.width,A=u.height;M.x=m/V*2-1,M.y=-(k/A)*2+1,S.set(M.x,M.y,1).unproject(e.object).sub(e.object.position).normalize()}function P(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function Y(t){I.set(t.clientX,t.clientY)}function G(t){y(t.clientX,t.clientX),p.set(t.clientX,t.clientY)}function x(t){F.set(t.clientX,t.clientY)}function _e(t){L.set(t.clientX,t.clientY),$.subVectors(L,I).multiplyScalar(e.rotateSpeed);const s=e.domElement;H(2*Math.PI*$.x/s.clientHeight),D(2*Math.PI*$.y/s.clientHeight),I.copy(L),e.update()}function ze(t){N.set(t.clientX,t.clientY),v.subVectors(N,p),v.y>0?l(z(v.y)):v.y<0&&j(z(v.y)),p.copy(N),e.update()}function He(t){U.set(t.clientX,t.clientY),d.subVectors(U,F).multiplyScalar(e.panSpeed),R(d.x,d.y),F.copy(U),e.update()}function Ye(t){y(t.clientX,t.clientY),t.deltaY<0?j(z(t.deltaY)):t.deltaY>0&&l(z(t.deltaY)),e.update()}function Ke(t){let s=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?D(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):R(0,e.keyPanSpeed),s=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?D(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):R(0,-e.keyPanSpeed),s=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?H(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):R(e.keyPanSpeed,0),s=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?H(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):R(-e.keyPanSpeed,0),s=!0;break}s&&(t.preventDefault(),e.update())}function be(t){if(h.length===1)I.set(t.pageX,t.pageY);else{const s=ee(t),u=.5*(t.pageX+s.x),m=.5*(t.pageY+s.y);I.set(u,m)}}function ye(t){if(h.length===1)F.set(t.pageX,t.pageY);else{const s=ee(t),u=.5*(t.pageX+s.x),m=.5*(t.pageY+s.y);F.set(u,m)}}function we(t){const s=ee(t),u=t.pageX-s.x,m=t.pageY-s.y,k=Math.sqrt(u*u+m*m);p.set(0,k)}function Fe(t){e.enableZoom&&we(t),e.enablePan&&ye(t)}function Ue(t){e.enableZoom&&we(t),e.enableRotate&&be(t)}function je(t){if(h.length==1)L.set(t.pageX,t.pageY);else{const u=ee(t),m=.5*(t.pageX+u.x),k=.5*(t.pageY+u.y);L.set(m,k)}$.subVectors(L,I).multiplyScalar(e.rotateSpeed);const s=e.domElement;H(2*Math.PI*$.x/s.clientHeight),D(2*Math.PI*$.y/s.clientHeight),I.copy(L)}function ke(t){if(h.length===1)U.set(t.pageX,t.pageY);else{const s=ee(t),u=.5*(t.pageX+s.x),m=.5*(t.pageY+s.y);U.set(u,m)}d.subVectors(U,F).multiplyScalar(e.panSpeed),R(d.x,d.y),F.copy(U)}function Ne(t){const s=ee(t),u=t.pageX-s.x,m=t.pageY-s.y,k=Math.sqrt(u*u+m*m);N.set(0,k),v.set(0,Math.pow(N.y/p.y,e.zoomSpeed)),l(v.y),p.copy(N);const V=(t.pageX+s.x)*.5,A=(t.pageY+s.y)*.5;y(V,A)}function Ze(t){e.enableZoom&&Ne(t),e.enablePan&&ke(t)}function Ge(t){e.enableZoom&&Ne(t),e.enableRotate&&je(t)}function Me(t){e.enabled!==!1&&(h.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",de),e.domElement.addEventListener("pointerup",se)),We(t),t.pointerType==="touch"?$e(t):Xe(t))}function de(t){e.enabled!==!1&&(t.pointerType==="touch"?Ve(t):Be(t))}function se(t){qe(t),h.length===0&&(e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",de),e.domElement.removeEventListener("pointerup",se)),e.dispatchEvent(Oe),i=n.NONE}function Xe(t){let s;switch(t.button){case 0:s=e.mouseButtons.LEFT;break;case 1:s=e.mouseButtons.MIDDLE;break;case 2:s=e.mouseButtons.RIGHT;break;default:s=-1}switch(s){case te.DOLLY:if(e.enableZoom===!1)return;G(t),i=n.DOLLY;break;case te.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;x(t),i=n.PAN}else{if(e.enableRotate===!1)return;Y(t),i=n.ROTATE}break;case te.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;Y(t),i=n.ROTATE}else{if(e.enablePan===!1)return;x(t),i=n.PAN}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(xe)}function Be(t){switch(i){case n.ROTATE:if(e.enableRotate===!1)return;_e(t);break;case n.DOLLY:if(e.enableZoom===!1)return;ze(t);break;case n.PAN:if(e.enablePan===!1)return;He(t);break}}function Ee(t){e.enabled===!1||e.enableZoom===!1||i!==n.NONE||(t.preventDefault(),e.dispatchEvent(xe),Ye(t),e.dispatchEvent(Oe))}function ue(t){e.enabled===!1||e.enablePan===!1||Ke(t)}function $e(t){switch(ve(t),h.length){case 1:switch(e.touches.ONE){case ae.ROTATE:if(e.enableRotate===!1)return;be(t),i=n.TOUCH_ROTATE;break;case ae.PAN:if(e.enablePan===!1)return;ye(t),i=n.TOUCH_PAN;break;default:i=n.NONE}break;case 2:switch(e.touches.TWO){case ae.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Fe(t),i=n.TOUCH_DOLLY_PAN;break;case ae.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ue(t),i=n.TOUCH_DOLLY_ROTATE;break;default:i=n.NONE}break;default:i=n.NONE}i!==n.NONE&&e.dispatchEvent(xe)}function Ve(t){switch(ve(t),i){case n.TOUCH_ROTATE:if(e.enableRotate===!1)return;je(t),e.update();break;case n.TOUCH_PAN:if(e.enablePan===!1)return;ke(t),e.update();break;case n.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ze(t),e.update();break;case n.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ge(t),e.update();break;default:i=n.NONE}}function Pe(t){e.enabled!==!1&&t.preventDefault()}function We(t){h.push(t.pointerId)}function qe(t){delete _[t.pointerId];for(let s=0;s<h.length;s++)if(h[s]==t.pointerId){h.splice(s,1);return}}function ve(t){let s=_[t.pointerId];s===void 0&&(s=new O,_[t.pointerId]=s),s.set(t.pageX,t.pageY)}function ee(t){const s=t.pointerId===h[0]?h[1]:h[0];return _[s]}e.domElement.addEventListener("contextmenu",Pe),e.domElement.addEventListener("pointerdown",Me),e.domElement.addEventListener("pointercancel",se),e.domElement.addEventListener("wheel",Ee,{passive:!1}),this.update()}}const Lt=[{name:"Front",icon:pt,position:[0,0,5],target:[0,0,0]},{name:"Top",icon:ge,position:[0,5,0],target:[0,0,0]},{name:"Side",icon:ge,position:[5,0,0],target:[0,0,0]}];function _t({animationState:o="idle",className:c}){const w=g.useRef(null),e=g.useRef(null),n=g.useRef(null),i=g.useRef(null),b=g.useRef(null),r=g.useRef(null),[f,K]=g.useState(!0),[C,I]=g.useState(!1),[L,$]=g.useState(!1),F=d=>{if(n.current&&b.current){const{position:p,target:N}=d;n.current.position.set(...p),b.current.target.set(...N)}};g.useEffect(()=>{if(!w.current)return;const d=w.current,p=()=>({width:d.clientWidth||1,height:d.clientHeight||1});let{width:N,height:v}=p();const S=new st;S.background=new nt(15857145),e.current=S,console.log("[AvatarCanvas] Scene initialized",{width:N,height:v});const M=new ot(45,N/v,.1,100);M.position.set(0,0,5),n.current=M;const E=new rt({antialias:!0,alpha:!0});E.setSize(N,v),E.setPixelRatio(Math.min(window.devicePixelRatio,2)),E.shadowMap.enabled=!0,E.shadowMap.type=it,d.appendChild(E.domElement),i.current=E;const h=new It(M,E.domElement);h.enableDamping=!0,h.dampingFactor=.05,h.enableZoom=!0,h.minDistance=2,h.maxDistance=10,h.enablePan=!1,b.current=h;const _=new lt(16777215,.4);S.add(_);const q=new me(16777215,1);q.position.set(5,5,5),q.castShadow=!0,S.add(q);const z=new me(16777215,.5);z.position.set(-5,3,2),S.add(z);const H=new me(8141549,.8);H.position.set(0,5,-5),S.add(H),U(S),K(!1),console.log("[AvatarCanvas] Scene initialization complete");let D;const Q=()=>{if(D=requestAnimationFrame(Q),h.update(),r.current&&r.current.children){const l=Date.now()*.001,j=r.current.children[0],y=r.current.children[1],P=r.current.children[2],Y=r.current.children[3],G=r.current.children[4];if(o==="idle"){if(r.current.position.y=Math.sin(l*1.5)*.08,r.current.rotation.y=Math.sin(l*.3)*.15,P&&(P.rotation.z=l*.2),Y&&(Y.rotation.x=Math.PI/3+Math.sin(l*.15)*.2),G&&(G.rotation.y=l*.25),y&&y.scale){const x=1+Math.sin(l*2)*.05;y.scale.set(x,x,x)}}else if(o==="thinking"){if(r.current.rotation.y=l*1.5,r.current.rotation.x=Math.sin(l*2)*.1,r.current.position.y=Math.sin(l*3)*.12+.2,P&&(P.rotation.z=l*.8,P.rotation.x=Math.sin(l*2)*.3),Y&&(Y.rotation.x=l*.6,Y.rotation.y=Math.cos(l*1.5)*.4),G&&(G.rotation.y=l*.7,G.rotation.z=Math.sin(l*2.5)*.3),y&&y.scale){const x=1+Math.sin(l*8)*.15;y.scale.set(x,x,x)}if(j&&j.scale){const x=1+Math.sin(l*10)*.1;j.scale.set(x,x,x)}}else if(o==="speaking"){if(r.current.rotation.y=Math.sin(l*5)*.2,r.current.position.y=Math.sin(l*8)*.05,P&&(P.rotation.z=Math.sin(l*4)*.3),Y&&(Y.rotation.x=Math.sin(l*4+1)*.3),G&&(G.rotation.y=Math.sin(l*4+2)*.3),y&&y.scale){const x=1+Math.sin(l*6)*.08;y.scale.set(x,x,x)}if(j&&j.scale){const x=1+Math.sin(l*12)*.08;j.scale.set(x,x,x)}}}i.current&&e.current&&n.current&&i.current.render(e.current,n.current)};Q();const Z=()=>{if(!d||!n.current||!i.current)return;const l=d.clientWidth||1,j=d.clientHeight||1;n.current.aspect=l/j,n.current.updateProjectionMatrix(),i.current.setSize(l,j)};window.addEventListener("resize",Z);const R=new ResizeObserver(()=>{Z()});return R.observe(d),()=>{window.removeEventListener("resize",Z),R.disconnect(),cancelAnimationFrame(D),h.dispose(),i.current&&d.contains(i.current.domElement)&&d.removeChild(i.current.domElement),i.current?.dispose()}},[o]),g.useEffect(()=>{if(C){const d=setTimeout(()=>I(!1),5e3);return()=>clearTimeout(d)}},[C]);function U(d){console.log("[AvatarCanvas] Creating procedural avatar...");const p=new ct,N=new Ae(.5,1),v=new pe({color:8141549,metalness:.7,roughness:.2,emissive:8141549,emissiveIntensity:.3,wireframe:!1}),S=new J(N,v);p.add(S);const M=new Ae(.7,2),E=new dt({color:10980346,wireframe:!0,transparent:!0,opacity:.4}),h=new J(M,E);p.add(h);const _=new pe({color:8141549,metalness:.8,roughness:.1,emissive:8141549,emissiveIntensity:.2}),q=new fe(.9,.02,16,100),z=new J(q,_);z.rotation.x=Math.PI/2,p.add(z);const H=new fe(1,.02,16,100),D=new J(H,_);D.rotation.x=Math.PI/3,D.rotation.y=Math.PI/6,p.add(D);const Q=new fe(.85,.02,16,100),Z=new J(Q,_);Z.rotation.y=Math.PI/4,p.add(Z);const R=new ut(.12,32,32),l=new pe({color:16777215,emissive:8141549,emissiveIntensity:.8,metalness:.9,roughness:.1}),j=new J(R,l);j.position.set(-.25,.15,.5),p.add(j);const y=new J(R,l);y.position.set(.25,.15,.5),p.add(y);const P=new ht(8141549,1,3);P.position.set(0,0,0),p.add(P),p.position.set(0,0,0),d.add(p),r.current=p,console.log("[AvatarCanvas] Avatar created successfully",{children:p.children.length})}return a.jsxs("div",{ref:w,className:ce("relative w-full h-full bg-gradient-to-b from-slate-50 to-white dark:from-slate-900 dark:to-slate-800",c),children:[f&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100 dark:bg-slate-800",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}),!f&&a.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[a.jsx("button",{onClick:()=>$(!L),className:"p-2 bg-white dark:bg-slate-700 rounded-lg shadow-lg hover:shadow-xl transition-shadow focus:outline-none focus:ring-2 focus:ring-purple-500",title:"Camera presets","aria-label":"Show camera presets",children:a.jsx(ge,{className:"w-5 h-5 text-slate-700 dark:text-slate-200"})}),a.jsx("button",{onClick:()=>I(!C),className:"p-2 bg-white dark:bg-slate-700 rounded-lg shadow-lg hover:shadow-xl transition-shadow focus:outline-none focus:ring-2 focus:ring-purple-500",title:"Show controls info","aria-label":"Show controls info",children:a.jsx(bt,{className:"w-5 h-5 text-slate-700 dark:text-slate-200"})}),a.jsx("button",{onClick:()=>{n.current&&b.current&&(n.current.position.set(0,0,5),b.current.target.set(0,0,0))},className:"p-2 bg-white dark:bg-slate-700 rounded-lg shadow-lg hover:shadow-xl transition-shadow focus:outline-none focus:ring-2 focus:ring-purple-500",title:"Reset view","aria-label":"Reset camera view",children:a.jsx(St,{className:"w-5 h-5 text-slate-700 dark:text-slate-200"})})]}),C&&!f&&a.jsx("div",{className:"absolute top-4 left-4 z-10 max-w-xs",children:a.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm rounded-lg shadow-lg p-3 text-xs space-y-2",children:[a.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100",children:"Controls"}),a.jsxs("div",{className:"space-y-1 text-slate-600 dark:text-slate-400",children:[a.jsxs("p",{children:["ðŸ–±ï¸ ",a.jsx("strong",{children:"Drag"})," to rotate"]}),a.jsxs("p",{children:["ðŸ¤ ",a.jsx("strong",{children:"Pinch"})," to zoom"]}),a.jsxs("p",{children:["âœ‹ ",a.jsx("strong",{children:"Two-finger"})," to pan (disabled)"]})]}),a.jsx("div",{className:"pt-2 border-t border-slate-200 dark:border-slate-700",children:a.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-500",children:"AI Core avatar with recursive orbital rings"})})]})}),L&&!f&&a.jsx("div",{className:"absolute top-16 right-4 z-10 flex flex-col gap-2",children:Lt.map(d=>{const p=d.icon;return a.jsx("button",{onClick:()=>F(d),className:"p-2 bg-white dark:bg-slate-700 rounded-lg shadow-lg hover:shadow-xl transition-shadow focus:outline-none focus:ring-2 focus:ring-purple-500",title:`Move to ${d.name} view`,"aria-label":`Switch to ${d.name} camera view`,children:a.jsx(p,{className:"w-5 h-5 text-slate-700 dark:text-slate-200"})},d.name)})})]})}function zt(){const[o,c]=g.useState(!0);return a.jsxs("div",{className:"px-4 py-2 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700",children:[!o&&a.jsxs("button",{onClick:()=>c(!0),className:"w-full flex items-center justify-between text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ce,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-spin"}),a.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:"Phase 3: PRACTICE"})]}),a.jsx(Mt,{className:"w-4 h-4 text-slate-400"})]}),o&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ce,{className:"w-4 h-4 text-purple-600 dark:text-purple-400 animate-spin-slow"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:"ðŸ”„ RSI Cycle #28"}),a.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Phase 3: PRACTICE â€¢ 2m 34s remaining"})]})]}),a.jsx("button",{onClick:()=>c(!1),className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",children:a.jsx(Pt,{className:"w-4 h-4 text-slate-400"})})]}),a.jsxs("div",{className:"flex gap-4 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Emergence:"}),a.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:"0.847 â†‘"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Treasury:"}),a.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-100",children:"$12.4K"})]})]})]})]})}const Le=mt(o=>({byrdState:null,messages:[],animationState:"idle",isTyping:!1,setByrdState:c=>o({byrdState:c}),setAnimationState:c=>o({animationState:c}),addMessage:c=>o(w=>({messages:[...w.messages,c]})),clearMessages:()=>o({messages:[]}),setTyping:c=>o({isTyping:c})}));function Ht(o){const c=new Date(o),e=new Date().getTime()-c.getTime(),n=Math.floor(e/1e3),i=Math.floor(n/60),b=Math.floor(i/60),r=Math.floor(b/24);return n<60?"just now":i<60?`${i}m ago`:b<24?`${b}h ago`:r<7?`${r}d ago`:c.toLocaleDateString()}function Yt({message:o}){const c=o.type==="user";return o.type==="system"?a.jsx("div",{className:"flex justify-center animate-fade-in",children:a.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 rounded-full",children:[a.jsx(yt,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"}),a.jsx("span",{className:"text-sm font-medium text-amber-900 dark:text-amber-100",children:o.content})]})}):a.jsx("div",{className:re("flex",c?"justify-end":"justify-start","animate-slide-up"),children:a.jsxs("div",{className:re("flex gap-3 max-w-[85%]",c?"flex-row-reverse":"flex-row"),children:[a.jsx("div",{className:re("flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center",c?"bg-blue-600 text-white":"bg-purple-600 dark:bg-purple-500 text-white"),children:c?a.jsx(Dt,{className:"w-5 h-5"}):a.jsx(jt,{className:"w-5 h-5"})}),a.jsxs("div",{className:re("flex flex-col",c?"items-end":"items-start"),children:[a.jsx("div",{className:re("px-4 py-2.5 rounded-2xl text-sm leading-relaxed",c?"bg-blue-600 text-white rounded-br-sm":"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 rounded-bl-sm"),children:o.content}),a.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1 px-1",children:Ht(o.timestamp)})]})]})})}function re(...o){return o.filter(Boolean).join(" ")}function Kt(){return a.jsx("div",{className:"flex justify-start animate-slide-up",children:a.jsxs("div",{className:"flex gap-3 max-w-[85%]",children:[a.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-purple-600 dark:bg-purple-500 flex items-center justify-center",children:a.jsx("span",{className:"text-sm",children:"ðŸ¦"})}),a.jsx("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-4 py-3 rounded-2xl rounded-bl-sm",children:a.jsx("div",{className:"flex gap-1.5",children:[0,1,2].map(o=>a.jsx("span",{className:"w-2 h-2 bg-slate-400 dark:bg-slate-500 rounded-full animate-pulse",style:{animationDelay:`${o*.15}s`,animationDuration:"0.8s"}},o))})})]})})}function Ft(){const{messages:o,isTyping:c}=Le(),w=g.useRef(null),e=g.useRef(o.length);return g.useEffect(()=>{o.length>e.current&&w.current?.scrollTo({top:w.current.scrollHeight,behavior:"smooth"}),e.current=o.length},[o.length]),a.jsxs("div",{ref:w,className:"flex-1 overflow-y-auto px-4 py-4 space-y-4",children:[o.length===0&&a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-3xl",children:"ðŸ¦"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Start a conversation with BYRD"}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 max-w-xs",children:"Ask about RSI cycles, set priorities, or inject new desires"})]})]}),o.map(n=>a.jsx(Yt,{message:n},n.id)),c&&a.jsx(Kt,{})]})}function Ut(){const[o,c]=g.useState(""),[w,e]=g.useState(!1),n=g.useRef(null),{addMessage:i,isTyping:b}=Le();g.useEffect(()=>{const f=n.current;f&&(f.style.height="auto",f.style.height=`${Math.min(f.scrollHeight,200)}px`)},[o]);const r=async f=>{f.preventDefault(),!(!o.trim()||b)&&(i({id:`msg_${Date.now()}`,type:"user",content:o.trim(),timestamp:new Date().toISOString()}),c(""),setTimeout(()=>{i({id:`msg_${Date.now()}_response`,type:"byrd",content:"I received your message. Processing...",timestamp:new Date().toISOString()})},1e3))};return a.jsx("form",{onSubmit:r,className:ce("flex-shrink-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 p-4",w&&"shadow-lg"),children:a.jsxs("div",{className:"flex items-end gap-2 max-w-4xl mx-auto",children:[a.jsx("div",{className:"flex-1 relative",children:a.jsx("textarea",{ref:n,value:o,onChange:f=>c(f.target.value),onFocus:()=>e(!0),onBlur:()=>e(!1),placeholder:"Type to BYRD...",rows:1,className:ce("w-full px-4 py-3 pr-2 rounded-xl resize-none","bg-slate-100 dark:bg-slate-800","border border-transparent","focus:bg-white dark:focus:bg-slate-700","focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20","text-slate-900 dark:text-slate-100 placeholder-slate-400","transition-all duration-200","max-h-48 overflow-y-auto"),disabled:b})}),a.jsx("button",{type:"submit",disabled:!o.trim()||b,className:ce("p-3 rounded-xl transition-all duration-200","bg-purple-600 hover:bg-purple-700 text-white","disabled:bg-slate-300 dark:disabled:bg-slate-700 disabled:cursor-not-allowed","active:scale-95"),children:a.jsx(At,{className:"w-5 h-5"})})]})})}function Vt(){const o=ft();return a.jsxs("div",{className:"flex flex-col h-screen bg-slate-50 dark:bg-slate-900",children:[a.jsx("header",{className:"flex-shrink-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[a.jsx("button",{onClick:()=>o(-1),className:"p-2 -ml-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":"Go back",children:a.jsx(xt,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),a.jsx("h1",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"BYRD"}),a.jsx("button",{className:"p-2 -mr-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors","aria-label":"Settings",children:a.jsx(gt,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})})]})}),a.jsx("div",{className:"flex-shrink-0 h-[45vh] min-h-[320px] max-h-[600px] relative",children:a.jsx(_t,{modelPath:"/models/cat.glb",animationState:"idle",autoRotate:!1,className:"w-full h-full"})}),a.jsx(zt,{}),a.jsx("div",{className:"flex-1 min-h-0 bg-white dark:bg-slate-800",children:a.jsx(Ft,{})}),a.jsx(Ut,{})]})}export{Vt as ByrdChatPage};
